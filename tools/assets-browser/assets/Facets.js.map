{"version":3,"file":"Facets.js","sources":["../../../koassets-react/src/components/DateRange.tsx","../../../scripts/saved-searches/saved-search-client.js","../../../koassets-react/src/components/Facets.tsx"],"sourcesContent":["import { forwardRef, useImperativeHandle, useState, useEffect } from 'react';\nimport { DateValue } from 'react-aria-components';\nimport './DateRange.css';\nimport MyDatePicker from './MyDatePicker';\nimport { parseNumericFiltersForDates, calendarDatesAreEqual } from '../utils/formatters';\n\ninterface DateRangeProps {\n    onDateRangeChange?: (startDate: Date | undefined, endDate: Date | undefined) => void;\n    selectedNumericFilters: string[];\n}\n\nexport interface DateRangeRef {\n    reset: () => void;\n}\n\nconst DateRange = forwardRef<DateRangeRef, DateRangeProps>(({ onDateRangeChange, selectedNumericFilters }, ref) => {\n    const [startDate, setStartDate] = useState<DateValue | null>(null);\n    const [endDate, setEndDate] = useState<DateValue | null>(null);\n\n    // Parse selectedNumericFilters to set start and end dates\n    useEffect(() => {\n        if (selectedNumericFilters.length > 0) {\n            const { startDate: parsedStartDate, endDate: parsedEndDate } = parseNumericFiltersForDates(selectedNumericFilters);\n\n            // Only update if we found valid dates and they're different from current state\n            if (parsedStartDate && !calendarDatesAreEqual(parsedStartDate, startDate)) {\n                setStartDate(parsedStartDate);\n            }\n\n            if (parsedEndDate && !calendarDatesAreEqual(parsedEndDate, endDate)) {\n                setEndDate(parsedEndDate);\n            }\n        }\n    }, [selectedNumericFilters, startDate, endDate, onDateRangeChange]);\n\n    const handleChangeStartDate = (date: DateValue | null) => {\n        setStartDate(date);\n\n        // Convert DateValue to Date and call callback\n        if (onDateRangeChange) {\n            const startJSDate = date ? new Date(date.year, date.month - 1, date.day) : undefined;\n            const endJSDate = endDate ? new Date(endDate.year, endDate.month - 1, endDate.day) : undefined;\n            onDateRangeChange(startJSDate, endJSDate);\n        }\n    };\n\n    const handleChangeEndDate = (date: DateValue | null) => {\n        setEndDate(date);\n\n        // Convert DateValue to Date and call callback\n        if (onDateRangeChange) {\n            const startJSDate = startDate ? new Date(startDate.year, startDate.month - 1, startDate.day) : undefined;\n            const endJSDate = date ? new Date(date.year, date.month - 1, date.day) : undefined;\n            onDateRangeChange(startJSDate, endJSDate);\n        }\n    };\n\n    const handleClearStartDate = () => {\n        setStartDate(null);\n        if (onDateRangeChange) {\n            const endJSDate = endDate ? new Date(endDate.year, endDate.month - 1, endDate.day) : undefined;\n            onDateRangeChange(undefined, endJSDate);\n        }\n    };\n\n    const handleClearEndDate = () => {\n        setEndDate(null);\n        if (onDateRangeChange) {\n            const startJSDate = startDate ? new Date(startDate.year, startDate.month - 1, startDate.day) : undefined;\n            onDateRangeChange(startJSDate, undefined);\n        }\n    };\n\n    useImperativeHandle(ref, () => ({\n        reset: () => {\n            setStartDate(null);\n            setEndDate(null);\n        }\n    }));\n\n    return (\n        <div className=\"date-range-filter\">\n            <div className=\"date-range-wrapper\">\n                <div className=\"date-range-inputs\">\n                    <div className={`date-range-input-wrapper ${selectedNumericFilters.length > 0 && startDate ? 'has-value' : ''}`}>\n                        <MyDatePicker<DateValue>\n                            value={startDate}\n                            onChange={handleChangeStartDate}\n                            label=\"From\"\n                            aria-label=\"From date\"\n                            showClearButton={!!startDate}\n                            onClear={handleClearStartDate}\n                        />\n                    </div>\n\n                    <div className={`date-range-input-wrapper ${selectedNumericFilters.length > 0 && endDate ? 'has-value' : ''}`}>\n                        <MyDatePicker<DateValue>\n                            value={endDate}\n                            onChange={handleChangeEndDate}\n                            label=\"To\"\n                            aria-label=\"To date\"\n                            showClearButton={!!endDate}\n                            onClear={handleClearEndDate}\n                        />\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n});\n\nDateRange.displayName = 'DateRange';\n\nexport default DateRange;","/**\n * Shared client for saved search operations\n * Uses Cloudflare KV storage via Saved Searches API\n * Works in both vanilla JavaScript and React environments\n * Provides a single source of truth for saved search CRUD operations\n */\n\nconst API_BASE = window.location.origin;\nlet cachedUserId = null;\n\n/**\n * Get current user ID\n * @returns {Promise<string>} User ID\n */\nasync function getUserId() {\n  if (cachedUserId) return cachedUserId;\n\n  try {\n    const response = await fetch(`${API_BASE}/api/user`, {\n      credentials: 'include',\n    });\n    const userData = await response.json();\n    cachedUserId = userData.userId || userData.email || 'anonymous';\n    return cachedUserId;\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error('Error fetching user ID:', error);\n    // Fallback to anonymous if user fetch fails\n    cachedUserId = 'anonymous';\n    return cachedUserId;\n  }\n}\n\n/**\n * Get the KV key for the current user's saved searches\n * @returns {Promise<string>} KV key\n */\nasync function getSavedSearchesKey() {\n  const userId = await getUserId();\n  return `user:${userId}:saved-searches`;\n}\n\n/**\n * Saved Search Client - Core operations using KV storage\n */\nexport const savedSearchClient = {\n  /**\n   * Load all saved searches from KV storage\n   * @returns {Promise<Array>} Array of saved search objects\n   */\n  async load() {\n    try {\n      const key = await getSavedSearchesKey();\n      const response = await fetch(`${API_BASE}/api/savedsearches/get?key=${encodeURIComponent(key)}`, {\n        credentials: 'include',\n      });\n      const data = await response.json();\n\n      if (!data.success) {\n        // Key doesn't exist yet, return empty array\n        if (data.error?.includes('not found')) {\n          return [];\n        }\n        throw new Error(data.error || 'Failed to load searches');\n      }\n\n      return data.value || [];\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.error('Error loading saved searches:', error);\n      return [];\n    }\n  },\n\n  /**\n   * Save searches to KV storage\n   * @param {Array} searches - Array of search objects to save\n   * @returns {Promise<boolean>} Success status\n   */\n  async save(searches) {\n    try {\n      const key = await getSavedSearchesKey();\n      const response = await fetch(`${API_BASE}/api/savedsearches/set`, {\n        method: 'POST',\n        credentials: 'include',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ key, value: searches }),\n      });\n      const data = await response.json();\n\n      if (!data.success) {\n        throw new Error(data.error || 'Failed to save searches');\n      }\n\n      return true;\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.error('Error saving searches:', error);\n      return false;\n    }\n  },\n\n  /**\n   * Create a new saved search\n   * @param {Object} searchData - Search data (name, searchTerm, filters, thumbnailImageId, etc.)\n   * @returns {Promise<Object>} The created search object\n   */\n  async create(searchData) {\n    const searches = await this.load();\n    const now = Date.now();\n    const newSearch = {\n      id: now.toString(),\n      dateCreated: now,\n      dateLastModified: now,\n      dateLastUsed: now,\n      favorite: false,\n      ...searchData,\n    };\n    searches.push(newSearch);\n    await this.save(searches);\n    return newSearch;\n  },\n\n  /**\n   * Update an existing saved search\n   * @param {string} searchId - ID of the search to update\n   * @param {Object} updates - Object with properties to update\n   * @returns {Promise<Object|null>} The updated search object or null if not found\n   */\n  async update(searchId, updates) {\n    const searches = await this.load();\n    const updatedSearches = searches.map((s) => {\n      if (s.id === searchId) {\n        return { ...s, ...updates, dateLastModified: Date.now() };\n      }\n      return s;\n    });\n    await this.save(updatedSearches);\n    return updatedSearches.find((s) => s.id === searchId) || null;\n  },\n\n  /**\n   * Delete a saved search\n   * @param {string} searchId - ID of the search to delete\n   * @returns {Promise<boolean>} True if deleted, false if not found\n   */\n  async delete(searchId) {\n    const searches = await this.load();\n    const filtered = searches.filter((s) => s.id !== searchId);\n    if (filtered.length < searches.length) {\n      await this.save(filtered);\n      return true;\n    }\n    return false;\n  },\n\n  /**\n   * Update the last used timestamp for a search\n   * @param {string} searchId - ID of the search\n   * @returns {Promise<Object|null>} The updated search object or null\n   */\n  async updateLastUsed(searchId) {\n    return this.update(searchId, { dateLastUsed: Date.now() });\n  },\n\n  /**\n   * Toggle favorite status for a search\n   * @param {string} searchId - ID of the search\n   * @returns {Promise<Object|null>} The updated search object or null\n   */\n  async toggleFavorite(searchId) {\n    const searches = await this.load();\n    const search = searches.find((s) => s.id === searchId);\n    if (search) {\n      return this.update(searchId, { favorite: !search.favorite });\n    }\n    return null;\n  },\n\n  /**\n   * Get a specific saved search by ID\n   * @param {string} searchId - ID of the search\n   * @returns {Promise<Object|null>} The search object or null if not found\n   */\n  async getById(searchId) {\n    const searches = await this.load();\n    return searches.find((s) => s.id === searchId) || null;\n  },\n\n  /**\n   * Count total filters in a saved search\n   * @param {Object} savedSearch - Saved search object\n   * @returns {number} Total count of filters\n   */\n  countFilters(savedSearch) {\n    let facetCount = 0;\n    if (savedSearch.facetFilters) {\n      Object.values(savedSearch.facetFilters).forEach((facetChecked) => {\n        Object.values(facetChecked).forEach((isChecked) => {\n          if (isChecked) facetCount += 1;\n        });\n      });\n    }\n    const numericCount = savedSearch.numericFilters ? savedSearch.numericFilters.length : 0;\n    return facetCount + numericCount;\n  },\n\n  /**\n   * Sort searches by last used date (most recent first)\n   * @param {Array} searches - Array of search objects\n   * @returns {Array} Sorted array\n   */\n  sortByLastUsed(searches) {\n    return [...searches].sort((a, b) => {\n      const aTime = a.dateLastUsed || a.dateLastModified || a.dateCreated || 0;\n      const bTime = b.dateLastUsed || b.dateLastModified || b.dateCreated || 0;\n      return bTime - aTime; // Most recent first\n    });\n  },\n\n  /**\n   * Filter searches by search term (name or searchTerm match)\n   * @param {Array} searches - Array of search objects\n   * @param {string} searchTerm - Term to filter by\n   * @returns {Array} Filtered searches\n   */\n  filter(searches, searchTerm) {\n    if (!searchTerm) return searches;\n\n    const lowerTerm = searchTerm.toLowerCase();\n    return searches.filter((search) => {\n      const nameMatch = search.name.toLowerCase().includes(lowerTerm);\n      const searchTermMatch = (search.searchTerm || '').toLowerCase().includes(lowerTerm);\n      return nameMatch || searchTermMatch;\n    });\n  },\n};\n\n// For backward compatibility, export individual functions (now async)\nexport const loadSavedSearches = () => savedSearchClient.load();\nexport const saveSavedSearches = (searches) => savedSearchClient.save(searches);\nexport const updateSearchLastUsed = (searchId) => savedSearchClient.updateLastUsed(searchId);\nexport const updateSavedSearch = (searchId, updates) => savedSearchClient.update(searchId, updates);\nexport const deleteSavedSearch = (searchId) => savedSearchClient.delete(searchId);\nexport const filterSearches = (searches, term) => savedSearchClient.filter(searches, term);\nexport const sortSearchesByLastUsed = (searches) => savedSearchClient.sortByLastUsed(searches);\nexport const countFilters = (savedSearch) => savedSearchClient.countFilters(savedSearch);\n","import { ToastQueue } from '@react-spectrum/toast';\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { DateValue } from 'react-aria-components';\nimport { CalendarDate } from '@internationalized/date';\nimport type { FacetsProps, FacetValue, RightsFilters, SavedSearch, SearchResult, RightsData } from '../types';\nimport DateRange, { DateRangeRef } from './DateRange';\nimport './Facets.css';\nimport Markets from './Markets';\nimport MediaChannels from './MediaChannels';\nimport MyDatePicker from './MyDatePicker';\nimport buildSavedSearchUrl from '../../../scripts/saved-searches/saved-search-utils.js';\nimport { savedSearchClient } from '../../../scripts/saved-searches/saved-search-client.js';\nimport { getDisplayFacetName } from '../utils/displayUtils';\nimport { calendarDateToEpoch, epochToCalendarDate } from '../utils/formatters';\n\ninterface ExpandedFacetsState {\n    [key: string]: boolean;\n}\n\nconst HIERARCHY_PREFIX = 'TCCC.#hierarchy.lvl';\n\n// React-specific saved search functions with rights filters serialization\nconst loadSavedSearches = async (): Promise<SavedSearch[]> => {\n    try {\n        const searches = await savedSearchClient.load();\n        \n        // Convert Arrays back to Sets and epoch timestamps back to DateValues after JSON deserialization\n        return searches.map((search: SavedSearch & {\n            rightsFilters: Omit<RightsFilters, 'markets' | 'mediaChannels' | 'rightsStartDate' | 'rightsEndDate'> & {\n                rightsStartDate: number | null;\n                rightsEndDate: number | null;\n                markets: RightsData[];\n                mediaChannels: RightsData[];\n            }\n        }) => ({\n            ...search,\n            rightsFilters: {\n                rightsStartDate: search.rightsFilters.rightsStartDate ? epochToCalendarDate(search.rightsFilters.rightsStartDate / 1000) : null,\n                rightsEndDate: search.rightsFilters.rightsEndDate ? epochToCalendarDate(search.rightsFilters.rightsEndDate / 1000) : null,\n                markets: new Set(search.rightsFilters.markets || []),\n                mediaChannels: new Set(search.rightsFilters.mediaChannels || [])\n            }\n        }));\n    } catch (error) {\n        console.error('Error loading saved searches:', error);\n        return [];\n    }\n};\n\nconst rightsFacets: Record<string, FacetValue> = {\n    'tccc-rightsStartDate': {\n        label: 'Rights Start Date',\n        type: 'date'\n    },\n    'tccc-rightsEndDate': {\n        label: 'Rights End Date',\n        type: 'date'\n    },\n    'tccc-marketCovered': {\n        label: 'Market Covered',\n        type: 'checkbox'\n    },\n    'tccc-mediaCovered': {\n        label: 'Media Covered',\n        type: 'checkbox'\n    }\n}\n\nconst saveSavedSearches = async (searches: SavedSearch[]): Promise<void> => {\n    try {\n        // Convert Sets to Arrays and DateValues to epoch for JSON serialization\n        const searchesForSaving = searches.map(search => ({\n            ...search,\n            rightsFilters: {\n                rightsStartDate: search.rightsFilters.rightsStartDate ? calendarDateToEpoch(search.rightsFilters.rightsStartDate as CalendarDate) : null,\n                rightsEndDate: search.rightsFilters.rightsEndDate ? calendarDateToEpoch(search.rightsFilters.rightsEndDate as CalendarDate) : null,\n                markets: Array.from(search.rightsFilters.markets),\n                mediaChannels: Array.from(search.rightsFilters.mediaChannels)\n            }\n        }));\n        \n        await savedSearchClient.save(searchesForSaving);\n    } catch (error) {\n        console.error('Error saving searches:', error);\n    }\n};\n\n// Interface for FacetItem props\ninterface FacetItemProps {\n    facetTechId: string;\n    facet: FacetValue;\n    label: string;\n    isExpanded: boolean;\n    isSearchMode: boolean;\n    searchTerm: string;\n    checkedCount: number;\n    onToggle: (facetTechId: string) => void;\n    onToggleSearch: (facetTechId: string, e: React.MouseEvent) => void;\n    onSearchChange: (facetTechId: string, value: string) => void;\n    onSearchEscape: (facetTechId: string) => void;\n    renderContent: (facetTechId: string) => React.ReactNode;\n}\n\n// Memoized FacetItem component to prevent unnecessary rerenders\nconst FacetItem = React.memo<FacetItemProps>(({\n    facetTechId,\n    facet,\n    label,\n    isExpanded,\n    isSearchMode,\n    searchTerm,\n    checkedCount,\n    onToggle,\n    onToggleSearch,\n    onSearchChange,\n    onSearchEscape,\n    renderContent\n}) => {\n    return (\n        <>\n            {facetTechId === 'tccc-rightsStartDate' && (\n                <div className=\"facet-rights-section\">\n                    <label className=\"facet-rights-label\">Check Rights Filters</label>\n                </div>\n            )}\n            <div className=\"facet-filter-section\">\n                {/* Render each facetTechId's search button */}\n                {isSearchMode ? (\n                    <div className=\"facet-filter-button facet-filter-button-search\">\n                        <div className=\"facet-search-container\">\n                            <div className=\"facet-search-input-wrapper\">\n                                <img\n                                    src=\"/icons/search.svg\"\n                                    alt=\"Search\"\n                                    className=\"facet-search-icon-inside\"\n                                />\n                                <input\n                                    type=\"text\"\n                                    className=\"facet-search-input\"\n                                    placeholder={`Search ${label}...`}\n                                    value={searchTerm}\n                                    autoFocus\n                                    onClick={(e) => e.stopPropagation()}\n                                    onChange={(e) => onSearchChange(facetTechId, e.target.value)}\n                                    onKeyDown={(e) => {\n                                        if (e.key === 'Escape') {\n                                            onSearchEscape(facetTechId);\n                                        }\n                                    }}\n                                />\n                                <img\n                                    src=\"/icons/close-menu.svg\"\n                                    alt=\"Close\"\n                                    className=\"facet-search-close-icon\"\n                                    onClick={(e) => onToggleSearch(facetTechId, e)}\n                                />\n                            </div>\n                        </div>\n                        <div className=\"facet-filter-right-section\">\n                            {checkedCount > 0 && (\n                                <div className=\"assets-details-tag tccc-tag facet-filter-count-tag\">{checkedCount}</div>\n                            )}\n                            <span\n                                className={`facet-filter-arrow-top-level ${isExpanded ? 'expanded' : ''}`}\n                                onClick={() => onToggle(facetTechId)}\n                            >\n                            </span>\n                        </div>\n                    </div>\n                ) : (\n                    // Render each facetTechId's button\n                    <div\n                        className=\"facet-filter-button\"\n                        tabIndex={0}\n                        aria-expanded={isExpanded}\n                        onClick={() => onToggle(facetTechId)}\n                    >\n                        <span className=\"facet-filter-label\">{label}</span>\n                        <div className=\"facet-filter-right-section\">\n                            {checkedCount > 0 && (\n                                <div className=\"assets-details-tag tccc-tag facet-filter-count-tag\">{checkedCount}</div>\n                            )}\n                            {isExpanded && facet.type !== 'date' && (\n                                <img\n                                    src=\"/icons/search.svg\"\n                                    alt=\"Search\"\n                                    className=\"facet-search-trigger\"\n                                    onClick={(e) => onToggleSearch(facetTechId, e)}\n                                />\n                            )}\n                            <span\n                                className={`facet-filter-arrow ${isExpanded ? 'expanded' : ''}`}\n                            ></span>\n                        </div>\n                    </div>\n                )}\n\n                {/* For each facet, render the appropriate checkboxes and hierarchy if needed */}\n                {renderContent(facetTechId)}\n            </div>\n        </>\n    );\n});\n\nFacetItem.displayName = 'FacetItem';\n\nconst Facets: React.FC<FacetsProps> = ({\n    searchResults,\n    search,\n    excFacets = {},\n    selectedNumericFilters = [],\n    setSelectedNumericFilters,\n    query,\n    setQuery,\n    searchDisabled,\n    setSearchDisabled,\n    setIsRightsSearch,\n    rightsStartDate,\n    setRightsStartDate,\n    rightsEndDate,\n    setRightsEndDate,\n    selectedMarkets,\n    setSelectedMarkets,\n    selectedMediaChannels,\n    setSelectedMediaChannels,\n    facetCheckedState,\n    setFacetCheckedState,\n    onFacetCheckbox,\n    onClearAllFacets\n}) => {\n    const [expandedFacets, setExpandedFacets] = useState<ExpandedFacetsState>({}); // Keep track of expanded facets (from EXC)\n    const [expandedHierarchyItems, setExpandedHierarchyItems] = useState<ExpandedFacetsState>({}); // Keep track of expanded hierarchy items\n    const [facetSearchMode, setFacetSearchMode] = useState<ExpandedFacetsState>({}); // Keep track of search mode for each facet\n    const [facetSearchTerms, setFacetSearchTerms] = useState<{ [key: string]: string }>({}); // Keep track of search terms for each facet\n    const [dateRanges, setDateRanges] = useState<{ [key: string]: [number | undefined, number | undefined] }>({});\n    const dateRangeRef = useRef<DateRangeRef>(null);\n    const isUpdatingFromExternalRef = useRef(false);\n\n    // Rights date picker handlers\n    const handleRightsStartDateChange = useCallback((date: DateValue | null) => {\n        setRightsStartDate?.(date);\n    }, [setRightsStartDate]);\n\n    const handleClearRightsStartDate = useCallback(() => {\n        setRightsStartDate?.(null);\n    }, [setRightsStartDate]);\n\n    const handleRightsEndDateChange = useCallback((date: DateValue | null) => {\n        setRightsEndDate?.(date);\n    }, [setRightsEndDate]);\n\n    const handleClearRightsEndDate = useCallback(() => {\n        setRightsEndDate?.(null);\n    }, [setRightsEndDate]);\n\n    // Saved search functionality state\n    const [activeView, setActiveView] = useState<'filters' | 'saved'>('filters');\n    const [savedSearches, setSavedSearches] = useState<SavedSearch[]>([]);\n    const [showSaveModal, setShowSaveModal] = useState(false);\n    const [saveSearchName, setSaveSearchName] = useState('');\n\n    // Load saved searches on mount\n    useEffect(() => {\n        loadSavedSearches().then(setSavedSearches);\n    }, []);\n\n    // Memoized combined facets computation - merges facets from all search results\n    const combinedFacets = useMemo((): SearchResult['facets'] => {\n        const combined: SearchResult['facets'] = {};\n\n        // Merge facets from all search results\n        searchResults?.forEach(searchResult => {\n            if (searchResult.facets) {\n                Object.entries(searchResult.facets).forEach(([key, facetData]) => {\n                    if (!combined[key]) {\n                        combined[key] = {};\n                    }\n                    Object.entries(facetData as { [key: string]: number }).forEach(([facetName, count]) => {\n                        combined[key]![facetName] = count;\n                    });\n                });\n            }\n        });\n\n        return combined;\n    }, [searchResults]);\n\n    // Note: Cleanup logic for checked state is now handled in the parent component (MainApp)\n\n    // Memoized hierarchy data computation for all facets\n    const hierarchyDataByFacet = useMemo(() => {\n        const hierarchyMap: { [facetTechId: string]: { [level: number]: { [key: string]: number } } } = {};\n\n        Object.keys(excFacets).forEach(facetTechId => {\n            // Check if this is a hierarchy facet by looking for hierarchy keys in search results\n            const isHierarchyFacet = Object.keys(combinedFacets || {}).some(key =>\n                key.startsWith(`${facetTechId}.${HIERARCHY_PREFIX}`)\n            );\n\n            if (isHierarchyFacet) {\n                const hierarchyData: { [level: number]: { [key: string]: number } } = {};\n\n                // Collect all hierarchy levels for this facet\n                Object.keys(combinedFacets || {}).forEach(key => {\n                    if (key.startsWith(`${facetTechId}.${HIERARCHY_PREFIX}`)) {\n                        // Extract level number from key like \"tccc-brand.TCCC.#hierarchy.lvl0\"\n                        const levelMatch = key.match(/\\.lvl(\\d+)$/);\n                        if (levelMatch) {\n                            const level = parseInt(levelMatch[1]);\n                            hierarchyData[level] = (combinedFacets && combinedFacets[key]) as { [key: string]: number };\n                        }\n                    }\n                });\n\n                // Sort each level based on facet's sortDirection setting\n                const sortDirection = excFacets[facetTechId]?.sortDirection?.toLowerCase();\n                if (sortDirection === 'asc' || sortDirection === 'desc') {\n                    Object.keys(hierarchyData).forEach(level => {\n                        const levelNum = parseInt(level);\n                        const sortedEntries = Object.entries(hierarchyData[levelNum])\n                            .sort(([facetNameA], [facetNameB]) => {\n                                // Extract the last part of the hierarchy path for sorting\n                                const lastTokenA = facetNameA.split(' / ').pop()?.trim() || '';\n                                const lastTokenB = facetNameB.split(' / ').pop()?.trim() || '';\n                                if (sortDirection === 'asc') {\n                                    return lastTokenA.localeCompare(lastTokenB);\n                                } else {\n                                    return lastTokenB.localeCompare(lastTokenA);\n                                }\n                            });\n                        hierarchyData[levelNum] = Object.fromEntries(sortedEntries);\n                    });\n                }\n\n                hierarchyMap[facetTechId] = hierarchyData;\n            }\n        });\n\n        return hierarchyMap;\n    }, [combinedFacets, excFacets]);\n\n    const toggle = useCallback((key: string) => {\n        setExpandedFacets(prev => {\n            const newExpanded = { ...prev, [key]: !prev[key] };\n\n            // If we're collapsing the facet (was expanded, now collapsed), close search mode and clear search terms\n            if (prev[key] && !newExpanded[key]) {\n                setFacetSearchMode(prevSearch => ({ ...prevSearch, [key]: false }));\n                setFacetSearchTerms(prevTerms => ({ ...prevTerms, [key]: '' }));\n            }\n\n            return newExpanded;\n        });\n    }, []);\n\n    const toggleHierarchyItem = useCallback((key: string, facetTechId: string, fullPath: string, hierarchyData: { [level: number]: { [key: string]: number } }) => {\n        setExpandedHierarchyItems(prev => {\n            const newExpanded = { ...prev };\n            const isCurrentlyExpanded = prev[key];\n\n            // Toggle the current item\n            newExpanded[key] = !isCurrentlyExpanded;\n\n            // If we're collapsing (was expanded, now collapsed), recursively collapse all children\n            if (isCurrentlyExpanded && !newExpanded[key]) {\n                // Find and collapse all descendant items\n                const collapseDescendants = (parentPath: string, startLevel: number) => {\n                    // Go through all levels starting from the next level\n                    for (let level = startLevel + 1; level < 10; level++) { // Assume max 10 levels\n                        const levelData = hierarchyData[level];\n                        if (!levelData) continue;\n\n                        Object.keys(levelData).forEach(facetName => {\n                            // Check if this item is a descendant of the parent\n                            if (facetName.startsWith(parentPath + ' / ')) {\n                                const descendantKey = `${facetTechId}-${facetName}`;\n                                newExpanded[descendantKey] = false;\n                            }\n                        });\n                    }\n                };\n\n                // Find the level of the current item by checking hierarchy data\n                let currentLevel = 1;\n                for (let level = 1; level < 10; level++) {\n                    const levelData = hierarchyData[level];\n                    if (levelData && levelData[fullPath] !== undefined) {\n                        currentLevel = level;\n                        break;\n                    }\n                }\n\n                collapseDescendants(fullPath, currentLevel);\n            }\n\n            return newExpanded;\n        });\n    }, []);\n\n    const toggleFacetSearch = useCallback((facetTechId: string, event: React.MouseEvent) => {\n        event.stopPropagation();\n        setFacetSearchMode(prev => ({ ...prev, [facetTechId]: !prev[facetTechId] }));\n        // Clear search term when exiting search mode\n        if (facetSearchMode[facetTechId]) {\n            setFacetSearchTerms(prev => ({ ...prev, [facetTechId]: '' }));\n        }\n    }, [facetSearchMode]);\n\n    const handleFacetSearchChange = useCallback((facetTechId: string, searchTerm: string) => {\n        setFacetSearchTerms(prev => ({ ...prev, [facetTechId]: searchTerm }));\n    }, []);\n\n    const handleFacetSearchEscape = useCallback((facetTechId: string) => {\n        setFacetSearchMode(prev => ({ ...prev, [facetTechId]: false }));\n        setFacetSearchTerms(prev => ({ ...prev, [facetTechId]: '' }));\n    }, []);\n\n\n    // Handler for date range change\n    const handleDateRangeChange = useCallback((key: string, startDate: Date | undefined, endDate: Date | undefined) => {\n        setDateRanges(prev => ({\n            ...prev,\n            [key]: [startDate ? startDate.getTime() / 1000 : undefined, endDate ? endDate.getTime() / 1000 : undefined]\n        }));\n    }, []);\n\n    // Helper function to check if hierarchy item should be shown based on search\n    const shouldShowHierarchyItem = useCallback((\n        hierarchyData: { [level: number]: { [key: string]: number } },\n        facetTechId: string,\n        facetName: string,\n        searchTerm: string,\n        level: number\n    ): boolean => {\n        if (!searchTerm) return true;\n\n        const lowerSearchTerm = searchTerm.toLowerCase();\n\n        // Check if the full hierarchy path contains the search term\n        const displayedFacetName = getDisplayFacetName(facetTechId, facetName);\n        if (displayedFacetName.toLowerCase().includes(lowerSearchTerm)) {\n            return true;\n        }\n\n        // Check if any descendant items at deeper levels match the search term\n        for (let deeperLevel = level + 1; deeperLevel < 10; deeperLevel++) {\n            const deeperLevelData = hierarchyData[deeperLevel];\n            if (!deeperLevelData) continue;\n\n            for (const [deeperFacetName] of Object.entries(deeperLevelData)) {\n                // Check if this deeper item is a descendant of the current item\n                if (deeperFacetName.startsWith(facetName + ' / ')) {\n                    // Check if the descendant matches the search term\n                    const displayedDeeperFacetName = getDisplayFacetName(facetTechId, deeperFacetName);\n                    if (displayedDeeperFacetName.toLowerCase().includes(lowerSearchTerm)) {\n                        return true;\n                    }\n                }\n            }\n        }\n\n        return false;\n    }, []);\n\n    /**\n     * Helper function to deselect facet items that no longer exist in search results\n     */\n    const deselectFacetCheckedState = useCallback((checkboxKey: string, facetDataMap: Record<string, number>) => {\n        if (facetCheckedState[checkboxKey]) {\n            Object.entries(facetCheckedState[checkboxKey]).forEach(([key, value]) => {\n                if (value === true) {\n                    if (!(key in facetDataMap) || facetDataMap[key] === 0) {\n                        onFacetCheckbox(checkboxKey, key);\n                    }\n                }\n            });\n        }\n    }, [facetCheckedState, onFacetCheckbox]);\n    \n\n    // Memoized function to render hierarchy levels\n    const renderHierarchyLevel = useCallback((\n        facetTechIdHierarchyData: { [level: number]: { [key: string]: number } },\n        facetTechId: string,\n        level: number,\n        parentPath: string = ''\n    ): React.ReactNode[] => {\n        const levelData = facetTechIdHierarchyData[level];\n        if (!levelData) return [];\n\n        const searchTerm = facetSearchTerms[facetTechId] || '';\n        const items: React.ReactNode[] = [];\n        const checkboxKey = `${facetTechId}.${HIERARCHY_PREFIX}${level}`;\n        deselectFacetCheckedState(checkboxKey, levelData);\n\n        Object.entries(levelData).forEach(([facetName, count]) => {\n            // Extract the last part of the hierarchy path for display\n            const pathParts = facetName.split(' / ');\n            const baseFacetName = pathParts[pathParts.length - 1].trim();\n            const displayName = getDisplayFacetName(facetTechId, baseFacetName);\n\n            // Filter based on search term - check full hierarchy path and descendants\n            if (searchTerm && !shouldShowHierarchyItem(facetTechIdHierarchyData, facetTechId, facetName, searchTerm, level)) {\n                return; // Skip this item if it doesn't match search\n            }\n\n            // Only show items that match the parent path or are at the starting level (level 1)\n            const currentPath = pathParts.slice(0, -1).join(' / ');\n            if (level === 1 || currentPath === parentPath) {\n                const fullPath = facetName;\n                const itemKey = `${facetTechId}-${facetName}`;\n\n                // Check if this item has sub-levels\n                const hasSubLevels = facetTechIdHierarchyData[level + 1] &&\n                    Object.keys(facetTechIdHierarchyData[level + 1]).some(subFacetName =>\n                        subFacetName.startsWith(fullPath + ' / ')\n                    );\n\n                // Apply CSS classes based on level and sub-levels\n                const containerClasses = [\n                    'facet-hierarchy-container',\n                    level > 1 ? 'facet-hierarchy-container-indented' : '',\n                    hasSubLevels ? 'facet-hierarchy-container-with-sublevel' : ''\n                ].filter(Boolean).join(' ');\n\n                const hierarchyItemKey = `${facetTechId}-${fullPath}`;\n                const isHierarchyItemExpanded = expandedHierarchyItems[hierarchyItemKey];\n\n                items.push(\n                    <div key={itemKey} className={containerClasses}>\n                        <div className=\"facet-filter-checkbox-label\" style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', width: '100%' }}>\n                            <label className=\"facet-filter-checkbox-label\" style={{ display: 'flex', alignItems: 'center', gap: '8px', margin: 0, cursor: 'pointer', flex: 1 }}>\n                                <input\n                                    className=\"facet-filter-checkbox-input\"\n                                    type=\"checkbox\"\n                                    checked={!!facetCheckedState[checkboxKey]?.[facetName]}\n                                    onChange={() => onFacetCheckbox(checkboxKey, facetName)}\n                                /> {displayName}{count > 0 ? ` (${count})` : ''}\n                            </label>\n                            {hasSubLevels && (\n                                <span\n                                    className={`facet-filter-arrow-sub-level caret-icon ${isHierarchyItemExpanded ? 'expanded' : ''}`}\n                                    onClick={() => toggleHierarchyItem(hierarchyItemKey, facetTechId, fullPath, facetTechIdHierarchyData)}\n                                >\n                                </span>\n                            )}\n                        </div>\n                        {/* Render child levels only if expanded */}\n                        {hasSubLevels && isHierarchyItemExpanded && renderHierarchyLevel(facetTechIdHierarchyData, facetTechId, level + 1, fullPath)}\n                    </div>\n                );\n            }\n        });\n\n        return items;\n    }, [facetCheckedState, onFacetCheckbox, expandedHierarchyItems, toggleHierarchyItem, facetSearchTerms, shouldShowHierarchyItem, deselectFacetCheckedState]);\n\n    /**\n     * Renders the facet checkboxes from search results\n     * @param facetTechId - The technical ID of the facet\n     * @returns JSX element with facet checkboxes or null\n     */\n    const renderFacetsFromSearchResult = useCallback((facetTechId: string) => {\n        if (!expandedFacets[facetTechId]) {\n            return null;\n        }\n\n        // Render date range for date facet\n        if (facetTechId === 'repo-createDate') {\n            return <DateRange\n                ref={dateRangeRef}\n                selectedNumericFilters={selectedNumericFilters}\n                onDateRangeChange={(startDate, endDate) => handleDateRangeChange(facetTechId, startDate, endDate)}\n            />;\n        }\n\n        // Render date picker for rights start date facet\n        if (facetTechId === 'tccc-rightsStartDate') {\n            return <MyDatePicker<DateValue>\n                className=\"rights-date-picker\"\n                value={rightsStartDate}\n                onChange={handleRightsStartDateChange}\n                label=\"From Rights Date\"\n                aria-label=\"From Rights Date\"\n                showClearButton={!!rightsStartDate}\n                onClear={handleClearRightsStartDate}\n            />;\n        }\n\n        // Render date picker for rights end date facet\n        if (facetTechId === 'tccc-rightsEndDate') {\n            return <MyDatePicker<DateValue>\n                className=\"rights-date-picker\"\n                value={rightsEndDate}\n                onChange={handleRightsEndDateChange}\n                label=\"To Rights Date\"\n                aria-label=\"To Rights Date\"\n                showClearButton={!!rightsEndDate}\n                onClear={handleClearRightsEndDate}\n            />;\n        }\n\n        // Render Markets\n        if (facetTechId === 'tccc-marketCovered') {\n            return <Markets\n                includeSearchBox={false}\n                selectedMarkets={selectedMarkets}\n                setSelectedMarkets={setSelectedMarkets}\n            />;\n        }\n\n        // Render Media Channels\n        if (facetTechId === 'tccc-mediaCovered') {\n            return <MediaChannels\n                selectedMediaChannels={selectedMediaChannels}\n                setSelectedMediaChannels={setSelectedMediaChannels}\n            />;\n        }\n\n        // Get hierarchy data for this facet if it exists\n        const facetTechIdHierarchyData = hierarchyDataByFacet[facetTechId];\n        const isHierarchyFacet = !!facetTechIdHierarchyData;\n\n        // Render each facetTechId's hierarchy items, e.g. 'Brand', 'Asset Category & Asset Type Execution'\n        if (isHierarchyFacet) {\n            return (\n                <div className=\"facet-filter-checkbox-list\">\n                    {renderHierarchyLevel(facetTechIdHierarchyData, facetTechId, 1)}\n                </div>\n            );\n        }\n\n        // Render each facetTechId's non-hierarchy items, e.g. 'Campaign', 'Rights Free'\n        if (!expandedFacets[facetTechId] || !combinedFacets || !combinedFacets[facetTechId] || Object.keys(combinedFacets[facetTechId] || {}).length === 0) {\n            return null;\n        }\n\n        const searchTerm = facetSearchTerms[facetTechId] || '';\n        const checkboxKey = `${facetTechId}`;\n        const facetTechIdDataMap = combinedFacets && combinedFacets[facetTechId] || {};\n        \n        deselectFacetCheckedState(checkboxKey, facetTechIdDataMap);\n\n        // Filter facet entries based on search term\n        let filteredEntries = Object.entries(facetTechIdDataMap)\n            .filter(([facetName]) => {\n                if (!searchTerm) return true;\n                const displayFacetName = getDisplayFacetName(facetTechId, facetName);\n                return displayFacetName.toLowerCase().includes(searchTerm.toLowerCase());\n            });\n\n        // Sort based on facet's sortDirection setting\n        const sortDirection = excFacets[facetTechId]?.sortDirection?.toLowerCase();\n        if (sortDirection === 'asc' || sortDirection === 'desc') {\n            filteredEntries = filteredEntries.sort(([facetNameA], [facetNameB]) => {\n                // Sort alphabetically by display name\n                const displayNameA = getDisplayFacetName(facetTechId, facetNameA);\n                const displayNameB = getDisplayFacetName(facetTechId, facetNameB);\n                if (sortDirection === 'asc') {\n                    return displayNameA.localeCompare(displayNameB);\n                } else {\n                    return displayNameB.localeCompare(displayNameA);\n                }\n            });\n        }\n\n        return (\n            <div className=\"facet-filter-checkbox-list\">\n                {filteredEntries.map(([facetName, count]) => {\n                    const displayName = getDisplayFacetName(facetTechId, facetName);\n                    \n                    return (\n                        <label key={facetName} className=\"facet-filter-checkbox-label\">\n                            <input\n                                type=\"checkbox\"\n                                checked={!!facetCheckedState[checkboxKey]?.[facetName]}\n                                onChange={() => onFacetCheckbox(checkboxKey, facetName)}\n                            /> {displayName}{count > 0 ? ` (${count})` : ''}\n                        </label>\n                    );\n                })}\n            </div>\n        );\n    }, [excFacets, expandedFacets, selectedNumericFilters, handleDateRangeChange, hierarchyDataByFacet, renderHierarchyLevel, combinedFacets, facetCheckedState, onFacetCheckbox, facetSearchTerms, handleClearRightsStartDate, handleRightsStartDateChange, rightsStartDate, handleClearRightsEndDate, handleRightsEndDateChange, rightsEndDate, selectedMarkets, selectedMediaChannels, setSelectedMarkets, setSelectedMediaChannels, deselectFacetCheckedState]);\n\n    // Convert date ranges to numeric filters for search\n    useEffect(() => {\n        if (Object.keys(dateRanges).length > 0) {\n            // Use setTimeout to defer the numeric filters update\n            setTimeout(() => {\n                setSelectedNumericFilters(Object.entries(dateRanges).flatMap(([key, value]) => {\n                    const filters = [];\n                    if (value[0] !== undefined) {\n                        filters.push(`${key} >= ${value[0]}`);\n                    }\n                    if (value[1] !== undefined) {\n                        filters.push(`${key} <= ${value[1]}`);\n                    }\n                    return filters;\n                }));\n            }, 0);\n        }\n        // Note: When dateRanges is empty, we don't call setSelectedNumericFilters([])\n        // because handleClearAllChecks handles this directly to avoid double searches\n    }, [dateRanges, setSelectedNumericFilters]);\n\n    // Count checked facets for a specific facetTechId\n    const getCheckedCount = useCallback((facetTechId: string): number => {\n        let count = 0;\n        Object.entries(facetCheckedState).forEach(([key, facetChecked]) => {\n            if (key === facetTechId || key.startsWith(`${facetTechId}.`)) {\n                Object.values(facetChecked).forEach(isChecked => {\n                    if (isChecked) count++;\n                });\n            }\n        });\n        return count;\n    }, [facetCheckedState]);\n\n    // Count all checked facets across all categories\n    const getTotalCheckedCount = useCallback((): number => {\n        let totalCount = 0;\n        Object.values(facetCheckedState).forEach(facetChecked => {\n            Object.values(facetChecked).forEach(isChecked => {\n                if (isChecked) totalCount++;\n            });\n        });\n        return totalCount;\n    }, [facetCheckedState]);\n\n    const handleClearAllChecks = useCallback(() => {\n        isUpdatingFromExternalRef.current = true;\n        setFacetCheckedState({});\n        setSelectedNumericFilters([]);\n        setRightsStartDate?.(null);\n        setRightsEndDate?.(null);\n        setSelectedMarkets(new Set());\n        setSelectedMediaChannels(new Set());\n        \n        // Clear Facets-specific UI state\n        setDateRanges({});\n        setExpandedFacets({}); // Collapse all facets\n        setExpandedHierarchyItems({}); // Collapse all hierarchy items\n        setFacetSearchMode({}); // Exit all search modes\n        setFacetSearchTerms({}); // Clear all search terms\n        dateRangeRef.current?.reset();\n    }, [setFacetCheckedState, setSelectedNumericFilters, setRightsStartDate, setRightsEndDate, setSelectedMarkets, setSelectedMediaChannels]);\n\n    // Pass handleClearAllChecks function to parent\n    useEffect(() => {\n        onClearAllFacets?.(handleClearAllChecks);\n    }, [handleClearAllChecks, onClearAllFacets]);\n\n    const handleApplyFilters = useCallback(() => {\n        search();\n    }, [search]);\n\n    /* Check rights parameters state (none, incomplete, and complete)\n       isNone: NO rights parameters have data\n       isIncomplete: some but not all 4 parameters have data\n       isComplete: ALL 4 parameters have data */\n    const rightsValidationState = useMemo(() => {\n        // Check if rights date parameters are complete (both set)\n        const hasRightsStartDate = !!rightsStartDate;\n        const hasRightsEndDate = !!rightsEndDate;\n        const isRightsDateComplete = hasRightsStartDate && hasRightsEndDate;\n        const hasAnyRightsDate = hasRightsStartDate || hasRightsEndDate;\n\n        // Calculate states\n        const hasAnyRightsData = selectedMarkets.size > 0 || selectedMediaChannels.size > 0 || hasAnyRightsDate;\n        const isComplete = selectedMarkets.size > 0 && selectedMediaChannels.size > 0 && isRightsDateComplete;\n        const isIncomplete = hasAnyRightsData && !isComplete;\n        const isNone = !hasAnyRightsData;\n\n        return { isNone, isIncomplete, isComplete };\n    }, [selectedMarkets, selectedMediaChannels, rightsStartDate, rightsEndDate]);\n\n\n    // Update parent's isRightsSearch state when rights parameters completeness changes\n    useEffect(() => {\n        setIsRightsSearch?.(rightsValidationState.isComplete);\n    }, [rightsValidationState.isComplete, setIsRightsSearch]);\n\n    // Update parent's searchDisabled state when rights parameters completeness changes\n    useEffect(() => {\n        if (setSearchDisabled) {\n            const shouldDisable = activeView === 'filters' && rightsValidationState.isIncomplete;\n            setSearchDisabled(shouldDisable);\n        }\n    }, [rightsValidationState.isIncomplete, setSearchDisabled, activeView]);\n\n    // Save search functionality\n    const handleSaveSearch = () => {\n        setShowSaveModal(true);\n    };\n\n    const handleSaveSearchConfirm = useCallback(() => {\n        if (saveSearchName.trim()) {\n            // Capture current search type from URL path\n            const currentPath = window.location.pathname;\n            let searchType = '/search/all'; // default fallback\n            if (currentPath.includes('/search/assets')) {\n                searchType = '/search/assets';\n            } else if (currentPath.includes('/search/products')) {\n                searchType = '/search/products';\n            } else if (currentPath.includes('/search/all')) {\n                searchType = '/search/all';\n            }\n\n            const rightsFilters: RightsFilters = {\n                rightsStartDate: rightsStartDate as DateValue,\n                rightsEndDate: rightsEndDate as DateValue,\n                markets: new Set(selectedMarkets),\n                mediaChannels: new Set(selectedMediaChannels)\n            };\n\n            // Get the first image ID from search results for thumbnail preview\n            let thumbnailImageId: string | undefined;\n            if (searchResults && searchResults[0]?.hits && searchResults[0].hits.length > 0) {\n                const firstHit = searchResults[0].hits[0];\n                thumbnailImageId = firstHit.assetId as string;\n            }\n\n            const now = Date.now();\n            const newSearch: SavedSearch = {\n                id: now.toString(),\n                name: saveSearchName.trim(),\n                searchTerm: query,\n                facetFilters: facetCheckedState,\n                numericFilters: [...selectedNumericFilters],\n                rightsFilters: rightsFilters,\n                dateCreated: now,\n                dateLastModified: now,\n                dateLastUsed: now,\n                favorite: false,\n                searchType: searchType,\n                thumbnailImageId: thumbnailImageId\n            };\n\n            const updatedSearches = [...savedSearches, newSearch];\n            setSavedSearches(updatedSearches);\n            saveSavedSearches(updatedSearches);\n\n            // Show success toast notification\n            ToastQueue.positive('SEARCH SAVED SUCCESSFULLY', { timeout: 3000 });\n\n            setSaveSearchName('');\n            setShowSaveModal(false);\n        }\n    }, [saveSearchName, selectedMarkets, selectedMediaChannels, rightsStartDate, rightsEndDate, query, facetCheckedState, selectedNumericFilters, savedSearches, searchResults]);\n\n    const handleSaveSearchCancel = () => {\n        setSaveSearchName('');\n        setShowSaveModal(false);\n    };\n\n    const handleLoadSavedSearch = (savedSearch: SavedSearch) => {\n        // If the saved search has a different search type, navigate to that URL\n        if (savedSearch.searchType) {\n            const currentPath = window.location.pathname;\n            \n            // Check if we need to navigate to a different search type\n            if (!currentPath.includes(savedSearch.searchType)) {\n                const searchUrl = buildSavedSearchUrl(savedSearch);\n                window.location.href = searchUrl;\n                return; // Exit early since we're navigating away\n            }\n        }\n        \n        // Dismiss any open tooltip\n        handleHideTooltip();\n\n        // Reset current filters\n        handleClearAllChecks();\n\n        // Load saved search term FIRST and ensure it's set before other updates\n        const searchTerm = savedSearch.searchTerm || '';\n        setQuery(searchTerm);\n\n        // Use setTimeout to ensure query state update is processed before filter updates\n        // This fixes the issue in block integration mode where state updates might be batched differently\n        setTimeout(() => {\n            // Set flag to indicate we're updating from saved search loading\n            isUpdatingFromExternalRef.current = true;\n\n            setFacetCheckedState(savedSearch.facetFilters); // populate the selected facets\n            setSelectedNumericFilters(savedSearch.numericFilters); // populate the selected numeric filters (createDate)\n\n            // populate the rights filters (start date, end date, markets and media channels)\n            if (savedSearch.rightsFilters) {\n                setRightsStartDate?.(savedSearch.rightsFilters.rightsStartDate);\n                setRightsEndDate?.(savedSearch.rightsFilters.rightsEndDate);\n                setSelectedMarkets(new Set(savedSearch.rightsFilters.markets));\n                setSelectedMediaChannels(new Set(savedSearch.rightsFilters.mediaChannels));\n            }\n\n            // Switch back to filters view\n            setActiveView('filters');\n\n            // Update last used timestamp\n            const now = Date.now();\n            const usedUpdated = savedSearches.map(s => s.id === savedSearch.id ? { ...s, dateLastUsed: now } : s);\n            setSavedSearches(usedUpdated);\n            saveSavedSearches(usedUpdated);\n        }, 0);\n    };\n\n    const handleDeleteSavedSearch = (searchId: string) => {\n        const searchToDelete = savedSearches.find(s => s.id === searchId);\n        const searchName = searchToDelete?.name || 'this saved search';\n\n        setDeleteSearchId(searchId);\n        setDeleteSearchName(searchName);\n        setShowDeleteModal(true);\n    };\n\n    const handleConfirmDelete = () => {\n        if (deleteSearchId) {\n            const updatedSearches = savedSearches.filter(s => s.id !== deleteSearchId);\n            setSavedSearches(updatedSearches);\n            saveSavedSearches(updatedSearches);\n\n            // Show success toast notification\n            ToastQueue.positive('SAVED SEARCH DELETED SUCCESSFULLY', { timeout: 3000 });\n        }\n        setShowDeleteModal(false);\n        setDeleteSearchId(null);\n        setDeleteSearchName('');\n    };\n\n    const handleCancelDelete = () => {\n        setShowDeleteModal(false);\n        setDeleteSearchId(null);\n        setDeleteSearchName('');\n    };\n\n    // Tooltip handlers\n    const handleShowTooltip = (searchId: string, event: React.MouseEvent) => {\n        setHoveredSearchId(searchId);\n        const rect = event.currentTarget.getBoundingClientRect();\n        setTooltipPosition({\n            x: rect.left + rect.width / 2,\n            y: rect.top - 10\n        });\n    };\n\n    const handleHideTooltip = () => {\n        setHoveredSearchId(null);\n    };\n\n    // Format last used date\n    const formatLastUsed = (timestamp?: number): string => {\n        if (!timestamp) return 'Never used';\n        const date = new Date(timestamp);\n        const now = new Date();\n        const diffMs = now.getTime() - date.getTime();\n        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\n\n        if (diffDays === 0) {\n            return 'Today';\n        } else if (diffDays === 1) {\n            return 'Yesterday';\n        } else if (diffDays < 7) {\n            return `${diffDays} days ago`;\n        } else {\n            return date.toLocaleDateString();\n        }\n    };\n\n    // Count total filters in saved search\n    const countFilters = (savedSearch: SavedSearch): number => {\n        let facetFilterCount = 0;\n        Object.values(savedSearch.facetFilters).forEach(facetChecked => {\n            Object.values(facetChecked).forEach(isChecked => {\n                if (isChecked) facetFilterCount++;\n            });\n        });\n        const numericFilterCount = savedSearch.numericFilters.length;\n        return facetFilterCount + numericFilterCount;\n    };\n\n\n    const handleCopySavedSearch = async (savedSearch: SavedSearch) => {\n        try {\n            const link = buildSavedSearchUrl(savedSearch);\n            await navigator.clipboard.writeText(link);\n            const now = Date.now();\n            const updated = savedSearches.map(s => s.id === savedSearch.id ? { ...s, dateLastUsed: now } : s);\n            setSavedSearches(updated);\n            saveSavedSearches(updated);\n\n            // Show success toast notification\n            ToastQueue.positive('SAVED SEARCH COPIED SUCCESSFULLY', { timeout: 3000 });\n        } catch (e) {\n            console.warn('[SavedSearch] clipboard copy failed, falling back to prompt');\n            // Fallback\n            window.prompt('Copy this link', buildSavedSearchUrl(savedSearch));\n            const now = Date.now();\n            const updated = savedSearches.map(s => s.id === savedSearch.id ? { ...s, dateLastUsed: now } : s);\n            setSavedSearches(updated);\n            saveSavedSearches(updated);\n\n            // Show success toast notification for fallback as well\n            ToastQueue.positive('SAVED SEARCH COPIED SUCCESSFULLY', { timeout: 3000 });\n        }\n    };\n\n    const [showEditLinkModal, setShowEditLinkModal] = useState(false);\n    const [editLinkText, setEditLinkText] = useState('');\n    const [editingSearchName, setEditingSearchName] = useState('');\n    const [editingSearchId, setEditingSearchId] = useState<string | null>(null);\n\n    // Delete confirmation modal state\n    const [showDeleteModal, setShowDeleteModal] = useState(false);\n    const [deleteSearchId, setDeleteSearchId] = useState<string | null>(null);\n    const [deleteSearchName, setDeleteSearchName] = useState('');\n\n    // Tooltip state\n    const [hoveredSearchId, setHoveredSearchId] = useState<string | null>(null);\n    const [tooltipPosition, setTooltipPosition] = useState({ x: 0, y: 0 });\n\n    const handleOpenEditLink = (savedSearch: SavedSearch) => {\n        const link = buildSavedSearchUrl(savedSearch);\n        setEditLinkText(link);\n        setEditingSearchName(savedSearch.name);\n        setEditingSearchId(savedSearch.id);\n        setShowEditLinkModal(true);\n    };\n\n    const handleCloseEditLink = () => {\n        setShowEditLinkModal(false);\n        setEditLinkText('');\n        setEditingSearchName('');\n        setEditingSearchId(null);\n    };\n\n    const handleConfirmEditLink = useCallback(() => {\n        if (!editingSearchId) {\n            setShowEditLinkModal(false);\n            return;\n        }\n\n        const rightsFilters: RightsFilters = {\n            rightsStartDate: rightsStartDate as DateValue,\n            rightsEndDate: rightsEndDate as DateValue,\n            markets: new Set(selectedMarkets),\n            mediaChannels: new Set(selectedMediaChannels)\n        };\n\n        // Get the first image ID from search results for thumbnail preview\n        let thumbnailImageId: string | undefined;\n        if (searchResults && searchResults[0]?.hits && searchResults[0].hits.length > 0) {\n            const firstHit = searchResults[0].hits[0];\n            thumbnailImageId = firstHit.assetId as string;\n        }\n        \n        const now = Date.now();\n        const updated = savedSearches.map(s => (\n            s.id === editingSearchId\n                ? {\n                    ...s,\n                    name: editingSearchName.trim() || s.name, // Use new name or keep existing if empty\n                    searchTerm: query,\n                    facetFilters: facetCheckedState,\n                    numericFilters: [...selectedNumericFilters],\n                    rightsFilters: rightsFilters,\n                    dateLastModified: now,\n                    thumbnailImageId: thumbnailImageId\n                }\n                : s\n        ));\n\n        setSavedSearches(updated);\n        saveSavedSearches(updated);\n\n        // Show success toast notification\n        ToastQueue.positive('SAVED SEARCH UPDATED SUCCESSFULLY', { timeout: 3000 });\n\n        setShowEditLinkModal(false);\n        setEditLinkText('');\n        setEditingSearchName('');\n        setEditingSearchId(null);\n    }, [editingSearchId, selectedMarkets, selectedMediaChannels, rightsStartDate, rightsEndDate, query, facetCheckedState, selectedNumericFilters, savedSearches, editingSearchName, searchResults]);\n\n    return (\n        <>\n            <div className=\"facet-filter-container\">\n                <div className=\"facet-filter\">\n                    <div className=\"facet-filter-header\">\n                        <div className=\"facet-filter-tabs\">\n                            <div\n                                className={`facet-filter-tab-group left ${activeView === 'filters' ? 'active' : ''}`}\n                                onClick={() => setActiveView('filters')}\n                                style={{ cursor: 'pointer' }}\n                            >\n                                <button\n                                    className={`facet-filter-tab ${activeView === 'filters' ? 'active' : ''}`}\n                                    onClick={() => setActiveView('filters')}\n                                    type=\"button\"\n                                >\n                                    Filters\n                                    {getTotalCheckedCount() > 0 && (\n                                        <div className=\"assets-details-tag tccc-tag facet-filter-count-tag\">{getTotalCheckedCount()}</div>\n                                    )}\n                                </button>\n                                <button\n                                    className={`facet-filter-tab clear`}\n                                    onClick={(e) => {\n                                        setActiveView('filters');\n                                        e.stopPropagation();\n                                        handleClearAllChecks();\n                                    }}\n                                    type=\"button\"\n                                >\n                                    CLEAR ALL\n                                </button>\n                            </div>\n                            <div\n                                className={`facet-filter-tab-group right ${activeView === 'saved' ? 'active' : ''}`}\n                                onClick={() => setActiveView('saved')}\n                                style={{ cursor: 'pointer' }}\n                            >\n                                <button\n                                    className={`facet-filter-tab ${activeView === 'saved' ? 'active' : ''}`}\n                                    onClick={() => setActiveView('saved')}\n                                    type=\"button\"\n                                >\n                                    My Saved Searches\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                    {activeView === 'filters' ? (\n                        <div className=\"facet-filter-list\">\n                            {/* Render facets that retrieved from EXC */}\n                            {(() => {\n                                const excEntries = Object.entries(excFacets);\n\n                                // Separate priority and regular facets\n                                const regularFacets = excEntries.filter(([key]) => !Object.keys(rightsFacets).includes(key));\n\n                                return [\n                                    ...regularFacets,\n                                    ...Object.entries(rightsFacets),\n                                ];\n                            })().map(([facetTechId, facet]) => {\n                                const label = facet.label || facetTechId;\n                                const checkedCount = getCheckedCount(facetTechId);\n\n                                return (\n                                    <FacetItem\n                                        key={facetTechId}\n                                        facetTechId={facetTechId}\n                                        facet={facet}\n                                        label={label}\n                                        isExpanded={!!expandedFacets[facetTechId]}\n                                        isSearchMode={!!facetSearchMode[facetTechId]}\n                                        searchTerm={facetSearchTerms[facetTechId] || ''}\n                                        checkedCount={checkedCount}\n                                        onToggle={toggle}\n                                        onToggleSearch={toggleFacetSearch}\n                                        onSearchChange={handleFacetSearchChange}\n                                        onSearchEscape={handleFacetSearchEscape}\n                                        renderContent={renderFacetsFromSearchResult}\n                                    />\n                                );\n                            })}\n                        </div >\n                    ) : (\n                        <div className=\"saved-searches-list\">\n                            {savedSearches.length === 0 ? (\n                                <div className=\"saved-searches-empty\">\n                                    <p>No saved searches yet.</p>\n                                    <p>Switch to Filters tab and click \"Save Search\" to save your first search.</p>\n                                </div>\n                            ) : (\n                                [...savedSearches]\n                                    .sort((a, b) => {\n                                        const favA = a.favorite ? 1 : 0;\n                                        const favB = b.favorite ? 1 : 0;\n                                        if (favB !== favA) return favB - favA; // favorites first\n                                        const usedA = a.dateLastUsed ?? 0;\n                                        const usedB = b.dateLastUsed ?? 0;\n                                        return usedB - usedA; // most recently used first\n                                    })\n                                    .map((savedSearch) => (\n                                        <div\n                                            key={savedSearch.id}\n                                            className=\"saved-search-item\"\n                                            onMouseEnter={(e) => handleShowTooltip(savedSearch.id, e)}\n                                            onMouseLeave={handleHideTooltip}\n                                        >\n                                            <div className=\"saved-search-info\">\n                                                <div className=\"saved-search-title\">\n                                                    <button\n                                                        className=\"saved-search-name-link\"\n                                                        type=\"button\"\n                                                        onClick={(e) => {\n                                                            handleLoadSavedSearch(savedSearch);\n                                                            (e.currentTarget as HTMLButtonElement).blur();\n                                                        }}\n                                                        title=\"Load this saved search\"\n                                                    >\n                                                        {savedSearch.name}\n                                                    </button>\n                                                    <button\n                                                        className={`saved-search-fav-btn ${savedSearch.favorite ? 'favorite' : ''}`}\n                                                        title=\"Favorite\"\n                                                        onClick={(e) => {\n                                                            const updated = savedSearches.map(s => s.id === savedSearch.id ? { ...s, favorite: !s.favorite } : s);\n                                                            setSavedSearches(updated);\n                                                            saveSavedSearches(updated);\n                                                            (e.currentTarget as HTMLButtonElement).blur();\n                                                        }}\n                                                        type=\"button\"\n                                                    >\n                                                        <img src={savedSearch.favorite ? `${import.meta.env.BASE_URL}icons/star-yellow.svg` : `${import.meta.env.BASE_URL}icons/star-grey.svg`} alt=\"Favorite\" />\n                                                    </button>\n                                                </div>\n                                                <div className=\"saved-search-actions-left\">\n                                                    <button\n                                                        className=\"saved-search-icon-btn\"\n                                                        title=\"Copy\"\n                                                        onClick={(e) => {\n                                                            handleCopySavedSearch(savedSearch);\n                                                            (e.currentTarget as HTMLButtonElement).blur();\n                                                        }}\n                                                        type=\"button\"\n                                                    >\n                                                        <img src={`${import.meta.env.BASE_URL}icons/copy-circle.svg`} alt=\"Copy\" />\n                                                    </button>\n                                                    <button\n                                                        className=\"saved-search-icon-btn\"\n                                                        title=\"Edit\"\n                                                        onClick={(e) => {\n                                                            handleOpenEditLink(savedSearch);\n                                                            (e.currentTarget as HTMLButtonElement).blur();\n                                                        }}\n                                                        type=\"button\"\n                                                    >\n                                                        <img src={`${import.meta.env.BASE_URL}icons/edit-circle.svg`} alt=\"Edit\" />\n                                                    </button>\n                                                    <button\n                                                        className=\"saved-search-delete-btn\"\n                                                        onClick={(e) => {\n                                                            handleDeleteSavedSearch(savedSearch.id);\n                                                            (e.currentTarget as HTMLButtonElement).blur();\n                                                        }}\n                                                        type=\"button\"\n                                                        title=\"Delete\"\n                                                    >\n                                                        <img src={`${import.meta.env.BASE_URL}icons/delete-circle.svg`} alt=\"Delete\" />\n                                                    </button>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    ))\n                            )}\n                        </div>\n                    )}\n                </div >\n            </div >\n\n            {/* Edit Saved Search Modal */}\n            {\n                showEditLinkModal && (\n                    <div className=\"save-search-modal\">\n                        <div className=\"save-search-modal-content\">\n                            <div className=\"save-search-modal-header\">\n                                <h3>Edit Saved Search</h3>\n                            </div>\n                            <div className=\"save-search-modal-body\">\n                                <div className=\"save-search-field\">\n                                    <label htmlFor=\"edit-search-name\" className=\"save-search-field-label\">Search Name:</label>\n                                    <input\n                                        id=\"edit-search-name\"\n                                        type=\"text\"\n                                        value={editingSearchName}\n                                        onChange={(e) => setEditingSearchName(e.target.value)}\n                                        className=\"save-search-input\"\n                                        placeholder=\"Enter search name\"\n                                        autoFocus\n                                    />\n                                </div>\n                                <div className=\"save-search-field\">\n                                    <label className=\"save-search-field-label\">Generated Link:</label>\n                                    <textarea\n                                        className=\"save-search-input save-search-link-display\"\n                                        value={editLinkText}\n                                        readOnly\n                                        rows={4}\n                                    />\n                                </div>\n                            </div>\n                            <div className=\"save-search-modal-footer\">\n                                <button className=\"save-search-cancel-btn\" onClick={handleCloseEditLink} type=\"button\">Cancel</button>\n                                <button\n                                    className=\"save-search-confirm-btn\"\n                                    onClick={handleConfirmEditLink}\n                                    type=\"button\"\n                                    disabled={!editingSearchName.trim()}\n                                >\n                                    Update\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                )\n            }\n\n\n\n            {/* Delete Confirmation Modal */}\n            {\n                showDeleteModal && (\n                    <div className=\"save-search-modal\">\n                        <div className=\"save-search-modal-content\">\n                            <div className=\"save-search-modal-header\">\n                                <h3>Delete Saved Search</h3>\n                            </div>\n                            <div className=\"save-search-modal-body\">\n                                <p>Are you sure you want to delete \"<strong>{deleteSearchName}</strong>\"?</p>\n                            </div>\n                            <div className=\"save-search-modal-footer\">\n                                <button\n                                    className=\"save-search-cancel-btn\"\n                                    onClick={handleCancelDelete}\n                                    type=\"button\"\n                                >\n                                    Cancel\n                                </button>\n                                <button\n                                    className=\"delete-search-confirm-btn\"\n                                    onClick={handleConfirmDelete}\n                                    type=\"button\"\n                                >\n                                    Delete\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                )\n            }\n\n            {/* Tooltip */}\n            {\n                hoveredSearchId && (\n                    <div\n                        className=\"saved-search-tooltip\"\n                        style={{\n                            position: 'fixed',\n                            left: `${tooltipPosition.x}px`,\n                            top: `${tooltipPosition.y}px`,\n                            transform: 'translate(-50%, -100%)',\n                            pointerEvents: 'none',\n                            zIndex: 1001\n                        }}\n                    >\n                        {(() => {\n                            const search = savedSearches.find(s => s.id === hoveredSearchId);\n                            if (!search) return null;\n                            return (\n                                <div className=\"tooltip-content\">\n                                    <div className=\"tooltip-search-terms\">\n                                        {search.searchTerm || 'No search terms'}\n                                    </div>\n                                    <div className=\"tooltip-filter-count\">\n                                        {(() => {\n                                            const filterCount = countFilters(search);\n                                            if (filterCount === 0) return 'No filters';\n                                            if (filterCount === 1) return '1 filter';\n                                            return `${filterCount} filters`;\n                                        })()}\n                                    </div>\n                                    <div className=\"tooltip-last-used\">\n                                        Last used: {formatLastUsed(search.dateLastUsed)}\n                                    </div>\n                                </div>\n                            );\n                        })()}\n                    </div>\n                )\n            }\n\n            {/* Inline Save Form */}\n            {\n                activeView === 'filters' && showSaveModal && (\n                    <div className=\"save-search-inline-form\">\n                        <div className=\"save-search-inline-input-container\">\n                            <input\n                                type=\"text\"\n                                placeholder=\"name for your saved search\"\n                                value={saveSearchName}\n                                onChange={(e) => setSaveSearchName(e.target.value)}\n                                className=\"save-search-inline-input\"\n                                autoFocus\n                                onKeyDown={(e) => {\n                                    if (e.key === 'Enter') {\n                                        handleSaveSearchConfirm();\n                                    } else if (e.key === 'Escape') {\n                                        handleSaveSearchCancel();\n                                    }\n                                }}\n                            />\n                            <button\n                                className=\"save-search-inline-save-btn\"\n                                type=\"button\"\n                                onClick={handleSaveSearchConfirm}\n                                disabled={!saveSearchName.trim()}\n                            >\n                                Save\n                            </button>\n                        </div>\n                    </div>\n                )\n            }\n\n            {/* Action Buttons */}\n            {\n                activeView === 'filters' && (\n                    <>\n                        {(searchDisabled || rightsValidationState.isIncomplete) && (\n                            <div className=\"rights-validation-warning\" >\n                                Select all rights parameters to enable the Apply button\n                            </div>\n                        )}\n                        <div className=\"facet-filter-buttons\">\n                            <button\n                                className=\"facet-filter-apply-btn\"\n                                type=\"button\"\n                                disabled={searchDisabled || rightsValidationState.isIncomplete}\n                                onClick={showSaveModal ? handleSaveSearchCancel : handleApplyFilters}\n                            >\n                                <span className=\"facet-filter-apply-icon\">\n                                    <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#fff\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                                        <polygon points=\"3 4 21 4 14 14 14 21 10 21 10 14 3 4\" />\n                                    </svg>\n                                </span>\n                                <span className=\"facet-filter-apply-text\">Apply</span>\n                            </button>\n                            <button\n                                className={`facet-filter-save-btn ${showSaveModal ? 'cancel-mode' : ''}`}\n                                type=\"button\"\n                                onClick={showSaveModal ? handleSaveSearchCancel : handleSaveSearch}\n                            >\n                                <span className=\"facet-filter-save-icon\">\n                                    <img src={`${import.meta.env.BASE_URL}icons/save-icon.svg`} alt=\"Save\" />\n                                </span>\n                                <span className=\"facet-filter-save-text\">{showSaveModal ? 'Cancel' : 'Save Search'}</span>\n                            </button>\n                        </div>\n                    </>\n                )\n            }\n        </>\n    );\n};\n\nexport default Facets; "],"names":["DateRange","forwardRef","onDateRangeChange","selectedNumericFilters","ref","startDate","setStartDate","useState","endDate","setEndDate","useEffect","length","parsedStartDate","parsedEndDate","parseNumericFiltersForDates","calendarDatesAreEqual","useImperativeHandle","reset","jsx","className","children","jsxs","MyDatePicker","value","onChange","date","startJSDate","Date","year","month","day","endJSDate","label","showClearButton","onClear","displayName","API_BASE","window","location","origin","cachedUserId","async","getSavedSearchesKey","response","fetch","credentials","userData","json","userId","email","error","console","getUserId","savedSearchClient","load","key","encodeURIComponent","data","success","_a","includes","Error","save","searches","method","headers","body","JSON","stringify","create","searchData","this","now","newSearch","id","toString","dateCreated","dateLastModified","dateLastUsed","favorite","push","update","searchId","updates","updatedSearches","map","s","find","filtered","filter","updateLastUsed","toggleFavorite","search","getById","countFilters","savedSearch","facetCount","facetFilters","Object","values","forEach","facetChecked","isChecked","numericCount","numericFilters","sortByLastUsed","sort","a","b","aTime","searchTerm","lowerTerm","toLowerCase","nameMatch","name","searchTermMatch","HIERARCHY_PREFIX","rightsFacets","type","saveSavedSearches","searchesForSaving","rightsFilters","rightsStartDate","calendarDateToEpoch","rightsEndDate","markets","Array","from","mediaChannels","FacetItem","React","memo","facetTechId","facet","isExpanded","isSearchMode","checkedCount","onToggle","onToggleSearch","onSearchChange","onSearchEscape","renderContent","Fragment","src","alt","placeholder","autoFocus","onClick","e","stopPropagation","target","onKeyDown","tabIndex","Facets","searchResults","excFacets","setSelectedNumericFilters","query","setQuery","searchDisabled","setSearchDisabled","setIsRightsSearch","setRightsStartDate","setRightsEndDate","selectedMarkets","setSelectedMarkets","selectedMediaChannels","setSelectedMediaChannels","facetCheckedState","setFacetCheckedState","onFacetCheckbox","onClearAllFacets","expandedFacets","setExpandedFacets","expandedHierarchyItems","setExpandedHierarchyItems","facetSearchMode","setFacetSearchMode","facetSearchTerms","setFacetSearchTerms","dateRanges","setDateRanges","dateRangeRef","useRef","isUpdatingFromExternalRef","handleRightsStartDateChange","useCallback","handleClearRightsStartDate","handleRightsEndDateChange","handleClearRightsEndDate","activeView","setActiveView","savedSearches","setSavedSearches","showSaveModal","setShowSaveModal","saveSearchName","setSaveSearchName","epochToCalendarDate","Set","loadSavedSearches","then","combinedFacets","useMemo","combined","searchResult","facets","entries","facetData","facetName","count","hierarchyDataByFacet","hierarchyMap","keys","some","startsWith","hierarchyData","levelMatch","match","level","parseInt","sortDirection","_b","levelNum","sortedEntries","facetNameA","facetNameB","lastTokenA","split","pop","trim","lastTokenB","localeCompare","fromEntries","toggle","prev","newExpanded","prevSearch","prevTerms","toggleHierarchyItem","fullPath","isCurrentlyExpanded","collapseDescendants","parentPath","startLevel","levelData","currentLevel","toggleFacetSearch","event","handleFacetSearchChange","handleFacetSearchEscape","handleDateRangeChange","getTime","shouldShowHierarchyItem","lowerSearchTerm","getDisplayFacetName","deeperLevel","deeperLevelData","deeperFacetName","deselectFacetCheckedState","checkboxKey","facetDataMap","renderHierarchyLevel","facetTechIdHierarchyData","items","pathParts","baseFacetName","currentPath","slice","join","itemKey","hasSubLevels","subFacetName","containerClasses","Boolean","hierarchyItemKey","isHierarchyItemExpanded","style","display","alignItems","justifyContent","width","gap","margin","cursor","flex","checked","renderFacetsFromSearchResult","Markets","includeSearchBox","MediaChannels","facetTechIdDataMap","filteredEntries","displayNameA","displayNameB","setTimeout","flatMap","filters","getCheckedCount","getTotalCheckedCount","totalCount","handleClearAllChecks","current","handleApplyFilters","rightsValidationState","hasRightsStartDate","hasRightsEndDate","isRightsDateComplete","hasAnyRightsDate","hasAnyRightsData","size","isComplete","isNone","isIncomplete","shouldDisable","handleSaveSearchConfirm","pathname","searchType","thumbnailImageId","hits","assetId","ToastQueue","positive","timeout","handleSaveSearchCancel","handleHideTooltip","setHoveredSearchId","formatLastUsed","timestamp","diffMs","diffDays","Math","floor","toLocaleDateString","showEditLinkModal","setShowEditLinkModal","editLinkText","setEditLinkText","editingSearchName","setEditingSearchName","editingSearchId","setEditingSearchId","showDeleteModal","setShowDeleteModal","deleteSearchId","setDeleteSearchId","deleteSearchName","setDeleteSearchName","hoveredSearchId","tooltipPosition","setTooltipPosition","x","y","handleConfirmEditLink","firstHit","updated","favA","favB","usedA","onMouseEnter","rect","currentTarget","getBoundingClientRect","left","top","handleShowTooltip","onMouseLeave","searchUrl","buildSavedSearchUrl","href","usedUpdated","handleLoadSavedSearch","blur","title","link","navigator","clipboard","writeText","warn","prompt","handleCopySavedSearch","handleOpenEditLink","searchToDelete","searchName","handleDeleteSavedSearch","htmlFor","readOnly","rows","disabled","position","transform","pointerEvents","zIndex","filterCount","facetFilterCount","numericFilterCount","height","viewBox","fill","stroke","strokeWidth","strokeLinecap","strokeLinejoin","points"],"mappings":"6IAeA,MAAMA,EAAYC,EAAAA,WAAyC,EAAGC,oBAAmBC,0BAA0BC,KACvG,MAAOC,EAAWC,GAAgBC,EAAAA,SAA2B,OACtDC,EAASC,GAAcF,EAAAA,SAA2B,MAGzDG,EAAAA,UAAU,KACN,GAAIP,EAAuBQ,OAAS,EAAG,CACnC,MAAQN,UAAWO,EAAiBJ,QAASK,GAAkBC,EAA4BX,GAGvFS,IAAoBG,EAAsBH,EAAiBP,IAC3DC,EAAaM,GAGbC,IAAkBE,EAAsBF,EAAeL,IACvDC,EAAWI,EAEnB,GACD,CAACV,EAAwBE,EAAWG,EAASN,IA+ChD,OAPAc,EAAAA,oBAAoBZ,EAAK,KAAA,CACrBa,MAAO,KACHX,EAAa,MACbG,EAAW,UAKfS,EAAAA,IAAC,MAAA,CAAIC,UAAU,oBACXC,WAAAF,IAAC,MAAA,CAAIC,UAAU,qBACXC,SAAAC,EAAAA,KAAC,MAAA,CAAIF,UAAU,oBACXC,SAAA,CAAAF,EAAAA,IAAC,MAAA,CAAIC,UAAW,6BAA4BhB,EAAuBQ,OAAS,GAAKN,EAAY,YAAc,IACvGe,SAAAF,EAAAA,IAACI,EAAA,CACGC,MAAOlB,EACPmB,SApDOC,IAI3B,GAHAnB,EAAamB,GAGTvB,EAAmB,CACnB,MAAMwB,EAAcD,EAAO,IAAIE,KAAKF,EAAKG,KAAMH,EAAKI,MAAQ,EAAGJ,EAAKK,UAAO,EACrEC,EAAYvB,EAAU,IAAImB,KAAKnB,EAAQoB,KAAMpB,EAAQqB,MAAQ,EAAGrB,EAAQsB,UAAO,EACrF5B,EAAkBwB,EAAaK,EACnC,GA6CoBC,MAAM,OACN,aAAW,YACXC,kBAAmB5B,EACnB6B,QAlCK,KAEzB,GADA5B,EAAa,MACTJ,EAAmB,CACnB,MAAM6B,EAAYvB,EAAU,IAAImB,KAAKnB,EAAQoB,KAAMpB,EAAQqB,MAAQ,EAAGrB,EAAQsB,UAAO,EACrF5B,OAAkB,EAAW6B,EACjC,OAiCYb,EAAAA,IAAC,MAAA,CAAIC,UAAW,6BAA4BhB,EAAuBQ,OAAS,GAAKH,EAAU,YAAc,IACrGY,SAAAF,EAAAA,IAACI,EAAA,CACGC,MAAOf,EACPgB,SApDKC,IAIzB,GAHAhB,EAAWgB,GAGPvB,EAAmB,CACnB,MAAMwB,EAAcrB,EAAY,IAAIsB,KAAKtB,EAAUuB,KAAMvB,EAAUwB,MAAQ,EAAGxB,EAAUyB,UAAO,EACzFC,EAAYN,EAAO,IAAIE,KAAKF,EAAKG,KAAMH,EAAKI,MAAQ,EAAGJ,EAAKK,UAAO,EACzE5B,EAAkBwB,EAAaK,EACnC,GA6CoBC,MAAM,KACN,aAAW,UACXC,kBAAmBzB,EACnB0B,QArCG,KAEvB,GADAzB,EAAW,MACPP,EAAmB,CACnB,MAAMwB,EAAcrB,EAAY,IAAIsB,KAAKtB,EAAUuB,KAAMvB,EAAUwB,MAAQ,EAAGxB,EAAUyB,UAAO,EAC/F5B,EAAkBwB,OAAa,EACnC,gBAyCR1B,EAAUmC,YAAc,YCxGxB,MAAMC,EAAWC,OAAOC,SAASC,OACjC,IAAIC,EAAe,KA6BnBC,eAAeC,IAEb,MAAO,cAzBTD,iBACE,GAAID,EAAc,OAAOA,EAEzB,IACE,MAAMG,QAAiBC,MAAM,GAAGR,aAAqB,CACnDS,YAAa,YAETC,QAAiBH,EAASI,OAEhC,OADAP,EAAeM,EAASE,QAAUF,EAASG,OAAS,YAC7CT,CACT,OAASU,GAKP,OAHAC,QAAQD,MAAM,0BAA2BA,GAEzCV,EAAe,YACRA,CACT,CACF,CAOuBY,mBAEvB,CAKO,MAAMC,EAAoB,CAK/B,UAAMC,SACJ,IACE,MAAMC,QAAYb,IACZC,QAAiBC,MAAM,GAAGR,+BAAsCoB,mBAAmBD,KAAQ,CAC/FV,YAAa,YAETY,QAAad,EAASI,OAE5B,IAAKU,EAAKC,QAAS,CAEjB,GAAI,OAAAC,EAAAF,EAAKP,YAAL,EAAAS,EAAYC,SAAS,aACvB,MAAO,GAET,MAAM,IAAIC,MAAMJ,EAAKP,OAAS,0BAChC,CAEA,OAAOO,EAAKlC,OAAS,EACvB,OAAS2B,GAGP,OADAC,QAAQD,MAAM,gCAAiCA,GACxC,EACT,CACF,EAOA,UAAMY,CAAKC,GACT,IACE,MAAMR,QAAYb,IACZC,QAAiBC,MAAM,GAAGR,0BAAkC,CAChE4B,OAAQ,OACRnB,YAAa,UACboB,QAAS,CAAE,eAAgB,oBAC3BC,KAAMC,KAAKC,UAAU,CAAEb,MAAKhC,MAAOwC,MAE/BN,QAAad,EAASI,OAE5B,IAAKU,EAAKC,QACR,MAAM,IAAIG,MAAMJ,EAAKP,OAAS,2BAGhC,OAAO,CACT,OAASA,GAGP,OADAC,QAAQD,MAAM,yBAA0BA,IACjC,CACT,CACF,EAOA,YAAMmB,CAAOC,GACX,MAAMP,QAAiBQ,KAAKjB,OACtBkB,EAAM7C,KAAK6C,MACXC,EAAY,CAChBC,GAAIF,EAAIG,WACRC,YAAaJ,EACbK,iBAAkBL,EAClBM,aAAcN,EACdO,UAAU,KACPT,GAIL,OAFAP,EAASiB,KAAKP,SACRF,KAAKT,KAAKC,GACTU,CACT,EAQA,YAAMQ,CAAOC,EAAUC,GACrB,MACMC,SADiBb,KAAKjB,QACK+B,IAAKC,GAChCA,EAAEZ,KAAOQ,EACJ,IAAKI,KAAMH,EAASN,iBAAkBlD,KAAK6C,OAE7Cc,GAGT,aADMf,KAAKT,KAAKsB,GACTA,EAAgBG,KAAMD,GAAMA,EAAEZ,KAAOQ,IAAa,IAC3D,EAOA,YAAM,CAAOA,GACX,MAAMnB,QAAiBQ,KAAKjB,OACtBkC,EAAWzB,EAAS0B,OAAQH,GAAMA,EAAEZ,KAAOQ,GACjD,OAAIM,EAAS7E,OAASoD,EAASpD,eACvB4D,KAAKT,KAAK0B,IACT,EAGX,EAOA,oBAAME,CAAeR,GACnB,OAAOX,KAAKU,OAAOC,EAAU,CAAEJ,aAAcnD,KAAK6C,OACpD,EAOA,oBAAMmB,CAAeT,GACnB,MACMU,SADiBrB,KAAKjB,QACJiC,KAAMD,GAAMA,EAAEZ,KAAOQ,GAC7C,OAAIU,EACKrB,KAAKU,OAAOC,EAAU,CAAEH,UAAWa,EAAOb,WAE5C,IACT,EAOA,aAAMc,CAAQX,GAEZ,aADuBX,KAAKjB,QACZiC,KAAMD,GAAMA,EAAEZ,KAAOQ,IAAa,IACpD,EAOA,YAAAY,CAAaC,GACX,IAAIC,EAAa,EACbD,EAAYE,cACdC,OAAOC,OAAOJ,EAAYE,cAAcG,QAASC,IAC/CH,OAAOC,OAAOE,GAAcD,QAASE,IAC/BA,IAAWN,GAAc,OAInC,MAAMO,EAAeR,EAAYS,eAAiBT,EAAYS,eAAe7F,OAAS,EACtF,OAAOqF,EAAaO,CACtB,EAOAE,eAAe1C,GACN,IAAIA,GAAU2C,KAAK,CAACC,EAAGC,KAC5B,MAAMC,EAAQF,EAAE7B,cAAgB6B,EAAE9B,kBAAoB8B,EAAE/B,aAAe,EAEvE,OADcgC,EAAE9B,cAAgB8B,EAAE/B,kBAAoB+B,EAAEhC,aAAe,GACxDiC,IAUnB,MAAApB,CAAO1B,EAAU+C,GACf,IAAKA,EAAY,OAAO/C,EAExB,MAAMgD,EAAYD,EAAWE,cAC7B,OAAOjD,EAAS0B,OAAQG,IACtB,MAAMqB,EAAYrB,EAAOsB,KAAKF,cAAcpD,SAASmD,GAC/CI,GAAmBvB,EAAOkB,YAAc,IAAIE,cAAcpD,SAASmD,GACzE,OAAOE,GAAaE,GAExB,GCxNIC,EAAmB,sBA8BnBC,EAA2C,CAC7C,uBAAwB,CACpBrF,MAAO,oBACPsF,KAAM,QAEV,qBAAsB,CAClBtF,MAAO,kBACPsF,KAAM,QAEV,qBAAsB,CAClBtF,MAAO,iBACPsF,KAAM,YAEV,oBAAqB,CACjBtF,MAAO,gBACPsF,KAAM,aAIRC,EAAoB9E,MAAOsB,IAC7B,IAEI,MAAMyD,EAAoBzD,EAASsB,IAAIO,IAAA,IAChCA,EACH6B,cAAe,CACXC,gBAAiB9B,EAAO6B,cAAcC,gBAAkBC,EAAoB/B,EAAO6B,cAAcC,iBAAmC,KACpIE,cAAehC,EAAO6B,cAAcG,cAAgBD,EAAoB/B,EAAO6B,cAAcG,eAAiC,KAC9HC,QAASC,MAAMC,KAAKnC,EAAO6B,cAAcI,SACzCG,cAAeF,MAAMC,KAAKnC,EAAO6B,cAAcO,yBAIjD3E,EAAkBS,KAAK0D,EACjC,OAAStE,GACLC,QAAQD,MAAM,yBAA0BA,EAC5C,GAoBE+E,EAAYC,EAAMC,KAAqB,EACzCC,cACAC,QACArG,QACAsG,aACAC,eACAzB,aACA0B,eACAC,WACAC,iBACAC,iBACAC,iBACAC,mBAGIxH,EAAAA,KAAAyH,WAAA,CACK1H,SAAA,CAAgB,yBAAhBgH,GACGlH,EAAAA,IAAC,MAAA,CAAIC,UAAU,uBACXC,eAAC,QAAA,CAAMD,UAAU,qBAAqBC,SAAA,6BAG9CC,KAAC,MAAA,CAAIF,UAAU,uBAEVC,SAAA,CAAAmH,EACGlH,EAAAA,KAAC,MAAA,CAAIF,UAAU,iDACXC,SAAA,CAAAF,EAAAA,IAAC,OAAIC,UAAU,yBACXC,SAAAC,EAAAA,KAAC,MAAA,CAAIF,UAAU,6BACXC,SAAA,CAAAF,EAAAA,IAAC,MAAA,CACG6H,IAAI,oBACJC,IAAI,SACJ7H,UAAU,6BAEdD,EAAAA,IAAC,QAAA,CACGoG,KAAK,OACLnG,UAAU,qBACV8H,YAAa,UAAUjH,OACvBT,MAAOuF,EACPoC,WAAS,EACTC,QAAUC,GAAMA,EAAEC,kBAClB7H,SAAW4H,GAAMT,EAAeP,EAAagB,EAAEE,OAAO/H,OACtDgI,UAAYH,IACM,WAAVA,EAAE7F,KACFqF,EAAeR,MAI3BlH,EAAAA,IAAC,MAAA,CACG6H,IAAI,wBACJC,IAAI,QACJ7H,UAAU,0BACVgI,QAAUC,GAAMV,EAAeN,EAAagB,YAIxD/H,KAAC,MAAA,CAAIF,UAAU,6BACVC,SAAA,CAAAoH,EAAe,GACZtH,EAAAA,IAAC,MAAA,CAAIC,UAAU,qDAAsDC,SAAAoH,IAEzEtH,EAAAA,IAAC,OAAA,CACGC,UAAW,iCAAgCmH,EAAa,WAAa,IACrEa,QAAS,IAAMV,EAASL,WAOpC/G,EAAAA,KAAC,MAAA,CACGF,UAAU,sBACVqI,SAAU,EACV,gBAAelB,EACfa,QAAS,IAAMV,EAASL,GAExBhH,SAAA,OAAC,OAAA,CAAKD,UAAU,qBAAsBC,SAAAY,MACtCX,KAAC,MAAA,CAAIF,UAAU,6BACVC,SAAA,CAAAoH,EAAe,GACZtH,EAAAA,IAAC,MAAA,CAAIC,UAAU,qDAAsDC,SAAAoH,IAExEF,GAA6B,SAAfD,EAAMf,MACjBpG,EAAAA,IAAC,MAAA,CACG6H,IAAI,oBACJC,IAAI,SACJ7H,UAAU,uBACVgI,QAAUC,GAAMV,EAAeN,EAAagB,KAGpDlI,EAAAA,IAAC,OAAA,CACGC,UAAW,uBAAsBmH,EAAa,WAAa,YAO1EO,EAAcT,UAM/BH,EAAU9F,YAAc,YAExB,MAAMsH,EAAgC,EAClCC,gBACA9D,SACA+D,YAAY,CAAA,EACZxJ,yBAAyB,GACzByJ,4BACAC,QACAC,WACAC,iBACAC,oBACAC,oBACAvC,kBACAwC,qBACAtC,gBACAuC,mBACAC,kBACAC,qBACAC,wBACAC,2BACAC,oBACAC,uBACAC,kBACAC,uBAEA,MAAOC,EAAgBC,GAAqBtK,EAAAA,SAA8B,CAAA,IACnEuK,EAAwBC,GAA6BxK,EAAAA,SAA8B,CAAA,IACnFyK,EAAiBC,GAAsB1K,EAAAA,SAA8B,CAAA,IACrE2K,EAAkBC,GAAuB5K,EAAAA,SAAoC,CAAA,IAC7E6K,EAAYC,GAAiB9K,EAAAA,SAAsE,CAAA,GACpG+K,EAAeC,EAAAA,OAAqB,MACpCC,EAA4BD,EAAAA,QAAO,GAGnCE,EAA8BC,cAAajK,IAC7C,MAAAyI,GAAAA,EAAqBzI,IACtB,CAACyI,IAEEyB,EAA6BD,EAAAA,YAAY,KAC3C,MAAAxB,GAAAA,EAAqB,OACtB,CAACA,IAEE0B,EAA4BF,cAAajK,IAC3C,MAAA0I,GAAAA,EAAmB1I,IACpB,CAAC0I,IAEE0B,EAA2BH,EAAAA,YAAY,KACzC,MAAAvB,GAAAA,EAAmB,OACpB,CAACA,KAGG2B,EAAYC,IAAiBxL,EAAAA,SAA8B,YAC3DyL,GAAeC,IAAoB1L,EAAAA,SAAwB,KAC3D2L,GAAeC,IAAoB5L,EAAAA,UAAS,IAC5C6L,GAAgBC,IAAqB9L,EAAAA,SAAS,IAGrDG,EAAAA,UAAU,KAhPY+B,WACtB,IAII,aAHuBY,EAAkBC,QAGzB+B,IAAKO,IAAA,IAQdA,EACH6B,cAAe,CACXC,gBAAiB9B,EAAO6B,cAAcC,gBAAkB4E,EAAoB1G,EAAO6B,cAAcC,gBAAkB,KAAQ,KAC3HE,cAAehC,EAAO6B,cAAcG,cAAgB0E,EAAoB1G,EAAO6B,cAAcG,cAAgB,KAAQ,KACrHC,QAAS,IAAI0E,IAAI3G,EAAO6B,cAAcI,SAAW,IACjDG,cAAe,IAAIuE,IAAI3G,EAAO6B,cAAcO,eAAiB,OAGzE,OAAS9E,GAEL,OADAC,QAAQD,MAAM,gCAAiCA,GACxC,EACX,GAyNIsJ,GAAoBC,KAAKR,KAC1B,IAGH,MAAMS,GAAiBC,EAAAA,QAAQ,KAC3B,MAAMC,EAAmC,CAAA,EAgBzC,OAbA,MAAAlD,GAAAA,EAAetD,QAAQyG,IACfA,EAAaC,QACb5G,OAAO6G,QAAQF,EAAaC,QAAQ1G,QAAQ,EAAE7C,EAAKyJ,MAC1CJ,EAASrJ,KACVqJ,EAASrJ,GAAO,CAAA,GAEpB2C,OAAO6G,QAAQC,GAAwC5G,QAAQ,EAAE6G,EAAWC,MACxEN,EAASrJ,GAAM0J,GAAaC,QAMrCN,GACR,CAAClD,IAKEyD,GAAuBR,EAAAA,QAAQ,KACjC,MAAMS,EAA0F,CAAA,EA+ChG,OA7CAlH,OAAOmH,KAAK1D,GAAWvD,QAAQgC,YAM3B,GAJyBlC,OAAOmH,KAAKX,IAAkB,CAAA,GAAIY,QACvD/J,EAAIgK,WAAW,GAAGnF,KAAehB,MAGf,CAClB,MAAMoG,EAAgE,CAAA,EAGtEtH,OAAOmH,KAAKX,IAAkB,CAAA,GAAItG,QAAQ7C,IACtC,GAAIA,EAAIgK,WAAW,GAAGnF,KAAehB,KAAqB,CAEtD,MAAMqG,EAAalK,EAAImK,MAAM,eAC7B,GAAID,EAAY,CACZ,MAAME,EAAQC,SAASH,EAAW,IAClCD,EAAcG,GAAUjB,IAAkBA,GAAenJ,EAC7D,CACJ,IAIJ,MAAMsK,EAAgB,OAAAC,EAAA,OAAAnK,EAAAgG,EAAUvB,SAAV,EAAAzE,EAAwBkK,oBAAxB,EAAAC,EAAuC9G,cACvC,QAAlB6G,GAA6C,SAAlBA,GAC3B3H,OAAOmH,KAAKG,GAAepH,QAAQuH,IAC/B,MAAMI,EAAWH,SAASD,GACpBK,EAAgB9H,OAAO6G,QAAQS,EAAcO,IAC9CrH,KAAK,EAAEuH,IAAcC,cAElB,MAAMC,GAAa,OAAAxK,EAAAsK,EAAWG,MAAM,OAAOC,YAAxB,EAAA1K,EAA+B2K,SAAU,GACtDC,GAAa,OAAAT,EAAAI,EAAWE,MAAM,OAAOC,YAAxB,EAAAP,EAA+BQ,SAAU,GAC5D,MAAsB,QAAlBT,EACOM,EAAWK,cAAcD,GAEzBA,EAAWC,cAAcL,KAG5CX,EAAcO,GAAY7H,OAAOuI,YAAYT,KAIrDZ,EAAahF,GAAeoF,CAChC,IAGGJ,GACR,CAACV,GAAgB/C,IAEd+E,GAAShD,cAAanI,IACxBsH,EAAkB8D,IACd,MAAMC,EAAc,IAAKD,EAAMpL,CAACA,IAAOoL,EAAKpL,IAQ5C,OALIoL,EAAKpL,KAASqL,EAAYrL,KAC1B0H,EAAmB4D,QAAoBA,EAAYtL,CAACA,IAAM,KAC1D4H,EAAoB2D,QAAmBA,EAAWvL,CAACA,GAAM,OAGtDqL,KAEZ,IAEGG,GAAsBrD,EAAAA,YAAY,CAACnI,EAAa6E,EAAqB4G,EAAkBxB,KACzFzC,EAA0B4D,IACtB,MAAMC,EAAc,IAAKD,GACnBM,EAAsBN,EAAKpL,GAMjC,GAHAqL,EAAYrL,IAAQ0L,EAGhBA,IAAwBL,EAAYrL,GAAM,CAE1C,MAAM2L,EAAsB,CAACC,EAAoBC,KAE7C,IAAA,IAASzB,EAAQyB,EAAa,EAAGzB,EAAQ,GAAIA,IAAS,CAClD,MAAM0B,EAAY7B,EAAcG,GAC3B0B,GAELnJ,OAAOmH,KAAKgC,GAAWjJ,QAAQ6G,IAE3B,GAAIA,EAAUM,WAAW4B,EAAa,OAAQ,CAE1CP,EADsB,GAAGxG,KAAe6E,MACX,CACjC,GAER,GAIJ,IAAIqC,EAAe,EACnB,IAAA,IAAS3B,EAAQ,EAAGA,EAAQ,GAAIA,IAAS,CACrC,MAAM0B,EAAY7B,EAAcG,GAChC,GAAI0B,QAAqC,IAAxBA,EAAUL,GAAyB,CAChDM,EAAe3B,EACf,KACJ,CACJ,CAEAuB,EAAoBF,EAAUM,EAClC,CAEA,OAAOV,KAEZ,IAEGW,GAAoB7D,EAAAA,YAAY,CAACtD,EAAqBoH,KACxDA,EAAMnG,kBACN4B,EAAmB0D,IAAA,IAAcA,EAAMvG,CAACA,IAAeuG,EAAKvG,MAExD4C,EAAgB5C,IAChB+C,EAAoBwD,QAAcA,EAAMvG,CAACA,GAAc,OAE5D,CAAC4C,IAEEyE,GAA0B/D,EAAAA,YAAY,CAACtD,EAAqBtB,KAC9DqE,EAAoBwD,QAAcA,EAAMvG,CAACA,GAActB,MACxD,IAEG4I,GAA0BhE,cAAatD,IACzC6C,EAAmB0D,QAAcA,EAAMvG,CAACA,IAAc,KACtD+C,EAAoBwD,QAAcA,EAAMvG,CAACA,GAAc,OACxD,IAIGuH,GAAwBjE,EAAAA,YAAY,CAACnI,EAAalD,EAA6BG,KACjF6K,EAAcsD,IAAA,IACPA,EACHpL,CAACA,GAAM,CAAClD,EAAYA,EAAUuP,UAAY,SAAO,EAAWpP,EAAUA,EAAQoP,UAAY,SAAO,OAEtG,IAGGC,GAA0BnE,EAAAA,YAAY,CACxC8B,EACApF,EACA6E,EACAnG,EACA6G,KAEA,IAAK7G,EAAY,OAAO,EAExB,MAAMgJ,EAAkBhJ,EAAWE,cAInC,GAD2B+I,EAAoB3H,EAAa6E,GACrCjG,cAAcpD,SAASkM,GAC1C,OAAO,EAIX,IAAA,IAASE,EAAcrC,EAAQ,EAAGqC,EAAc,GAAIA,IAAe,CAC/D,MAAMC,EAAkBzC,EAAcwC,GACtC,GAAKC,EAEL,IAAA,MAAYC,KAAoBhK,OAAO6G,QAAQkD,GAE3C,GAAIC,EAAgB3C,WAAWN,EAAY,OAAQ,CAG/C,GADiC8C,EAAoB3H,EAAa8H,GACrClJ,cAAcpD,SAASkM,GAChD,OAAO,CAEf,CAER,CAEA,OAAO,GACR,IAKGK,GAA4BzE,EAAAA,YAAY,CAAC0E,EAAqBC,KAC5D7F,EAAkB4F,IAClBlK,OAAO6G,QAAQvC,EAAkB4F,IAAchK,QAAQ,EAAE7C,EAAKhC,OAC5C,IAAVA,IACMgC,KAAO8M,GAAuC,IAAtBA,EAAa9M,IACvCmH,EAAgB0F,EAAa7M,OAK9C,CAACiH,EAAmBE,IAIjB4F,GAAuB5E,EAAAA,YAAY,CACrC6E,EACAnI,EACAuF,EACAwB,EAAqB,MAErB,MAAME,EAAYkB,EAAyB5C,GAC3C,IAAK0B,EAAW,MAAO,GAEvB,MAAMvI,EAAaoE,EAAiB9C,IAAgB,GAC9CoI,EAA2B,GAC3BJ,EAAc,GAAGhI,KAAehB,IAAmBuG,IA8DzD,OA7DAwC,GAA0BC,EAAaf,GAEvCnJ,OAAO6G,QAAQsC,GAAWjJ,QAAQ,EAAE6G,EAAWC,YAE3C,MAAMuD,EAAYxD,EAAUmB,MAAM,OAC5BsC,EAAgBD,EAAUA,EAAU9P,OAAS,GAAG2N,OAChDnM,EAAc4N,EAAoB3H,EAAasI,GAGrD,GAAI5J,IAAe+I,GAAwBU,EAA0BnI,EAAa6E,EAAWnG,EAAY6G,GACrG,OAIJ,MAAMgD,EAAcF,EAAUG,MAAM,GAAG,GAAIC,KAAK,OAChD,GAAc,IAAVlD,GAAegD,IAAgBxB,EAAY,CAC3C,MAAMH,EAAW/B,EACX6D,EAAU,GAAG1I,KAAe6E,IAG5B8D,EAAeR,EAAyB5C,EAAQ,IAClDzH,OAAOmH,KAAKkD,EAAyB5C,EAAQ,IAAIL,KAAK0D,GAClDA,EAAazD,WAAWyB,EAAW,QAIrCiC,EAAmB,CACrB,4BACAtD,EAAQ,EAAI,qCAAuC,GACnDoD,EAAe,0CAA4C,IAC7DtL,OAAOyL,SAASL,KAAK,KAEjBM,EAAmB,GAAG/I,KAAe4G,IACrCoC,EAA0BtG,EAAuBqG,GAEvDX,EAAMxL,OACF3D,KAAC,MAAA,CAAkBF,UAAW8P,EAC1B7P,SAAA,QAAC,MAAA,CAAID,UAAU,8BAA8BkQ,MAAO,CAAEC,QAAS,OAAQC,WAAY,SAAUC,eAAgB,gBAAiBC,MAAO,QACjIrQ,SAAA,CAAAC,OAAC,SAAMF,UAAU,8BAA8BkQ,MAAO,CAAEC,QAAS,OAAQC,WAAY,SAAUG,IAAK,MAAOC,OAAQ,EAAGC,OAAQ,UAAWC,KAAM,GAC3IzQ,SAAA,CAAAF,EAAAA,IAAC,QAAA,CACGC,UAAU,8BACVmG,KAAK,WACLwK,WAAW,OAAAnO,EAAA6G,EAAkB4F,SAAlB,EAAAzM,EAAiCsJ,IAC5CzL,SAAU,IAAMkJ,EAAgB0F,EAAanD,KAC/C,IAAE9K,EAAa+K,EAAQ,EAAI,KAAKA,KAAW,MAEhD6D,GACG7P,EAAAA,IAAC,OAAA,CACGC,UAAW,4CAA2CiQ,EAA0B,WAAa,IAC7FjI,QAAS,IAAM4F,GAAoBoC,EAAkB/I,EAAa4G,EAAUuB,QAMvFQ,GAAgBK,GAA2Bd,GAAqBC,EAA0BnI,EAAauF,EAAQ,EAAGqB,KAnB7G8B,GAsBlB,IAGGN,GACR,CAAChG,EAAmBE,EAAiBI,EAAwBiE,GAAqB7D,EAAkB2E,GAAyBM,KAO1H4B,GAA+BrG,cAAatD,YAC9C,IAAKwC,EAAexC,GAChB,OAAO,KAIX,GAAoB,oBAAhBA,EACA,OAAOlH,EAAAA,IAAClB,EAAA,CACJI,IAAKkL,EACLnL,yBACAD,kBAAmB,CAACG,EAAWG,IAAYmP,GAAsBvH,EAAa/H,EAAWG,KAKjG,GAAoB,yBAAhB4H,EACA,OAAOlH,EAAAA,IAACI,EAAA,CACJH,UAAU,qBACVI,MAAOmG,EACPlG,SAAUiK,EACVzJ,MAAM,mBACN,aAAW,mBACXC,kBAAmByF,EACnBxF,QAASyJ,IAKjB,GAAoB,uBAAhBvD,EACA,OAAOlH,EAAAA,IAACI,EAAA,CACJH,UAAU,qBACVI,MAAOqG,EACPpG,SAAUoK,EACV5J,MAAM,iBACN,aAAW,iBACXC,kBAAmB2F,EACnB1F,QAAS2J,IAKjB,GAAoB,uBAAhBzD,EACA,OAAOlH,EAAAA,IAAC8Q,EAAA,CACJC,kBAAkB,EAClB7H,kBACAC,uBAKR,GAAoB,sBAAhBjC,EACA,OAAOlH,EAAAA,IAACgR,EAAA,CACJ5H,wBACAC,6BAKR,MAAMgG,EAA2BpD,GAAqB/E,GAItD,KAH2BmI,EAIvB,OACIrP,MAAC,OAAIC,UAAU,6BACVC,YAAqBmP,EAA0BnI,EAAa,KAMzE,IAAKwC,EAAexC,KAAiBsE,KAAmBA,GAAetE,IAA0E,IAA1DlC,OAAOmH,KAAKX,GAAetE,IAAgB,CAAA,GAAIzH,OAClI,OAAO,KAGX,MAAMmG,EAAaoE,EAAiB9C,IAAgB,GAC9CgI,EAAc,GAAGhI,IACjB+J,EAAqBzF,IAAkBA,GAAetE,IAAgB,CAAA,EAE5E+H,GAA0BC,EAAa+B,GAGvC,IAAIC,EAAkBlM,OAAO6G,QAAQoF,GAChC1M,OAAO,EAAEwH,MACN,IAAKnG,EAAY,OAAO,EAExB,OADyBiJ,EAAoB3H,EAAa6E,GAClCjG,cAAcpD,SAASkD,EAAWE,iBAIlE,MAAM6G,EAAgB,OAAAC,EAAA,OAAAnK,EAAAgG,EAAUvB,SAAV,EAAAzE,EAAwBkK,oBAAxB,EAAAC,EAAuC9G,cAc7D,MAbsB,QAAlB6G,GAA6C,SAAlBA,IAC3BuE,EAAkBA,EAAgB1L,KAAK,EAAEuH,IAAcC,MAEnD,MAAMmE,EAAetC,EAAoB3H,EAAa6F,GAChDqE,EAAevC,EAAoB3H,EAAa8F,GACtD,MAAsB,QAAlBL,EACOwE,EAAa7D,cAAc8D,GAE3BA,EAAa9D,cAAc6D,MAM1CnR,MAAC,MAAA,CAAIC,UAAU,6BACVC,SAAAgR,EAAgB/M,IAAI,EAAE4H,EAAWC,YAC9B,MAAM/K,EAAc4N,EAAoB3H,EAAa6E,GAErD,SACI5L,KAAC,QAAA,CAAsBF,UAAU,8BAC7BC,SAAA,CAAAF,EAAAA,IAAC,QAAA,CACGoG,KAAK,WACLwK,WAAW,OAAAnO,EAAA6G,EAAkB4F,WAAlBzM,EAAiCsJ,IAC5CzL,SAAU,IAAMkJ,EAAgB0F,EAAanD,KAC/C,IAAE9K,EAAa+K,EAAQ,EAAI,KAAKA,KAAW,KALrCD,QAW7B,CAACtD,EAAWiB,EAAgBzK,EAAwBwP,GAAuBxC,GAAsBmD,GAAsB5D,GAAgBlC,EAAmBE,EAAiBQ,EAAkBS,EAA4BF,EAA6B/D,EAAiBmE,EAA0BD,EAA2BhE,EAAewC,EAAiBE,EAAuBD,EAAoBE,EAA0B4F,KAGpazP,EAAAA,UAAU,KACFwF,OAAOmH,KAAKjC,GAAYzK,OAAS,GAEjC4R,WAAW,KACP3I,EAA0B1D,OAAO6G,QAAQ3B,GAAYoH,QAAQ,EAAEjP,EAAKhC,MAChE,MAAMkR,EAAU,GAOhB,YANiB,IAAblR,EAAM,IACNkR,EAAQzN,KAAK,GAAGzB,QAAUhC,EAAM,WAEnB,IAAbA,EAAM,IACNkR,EAAQzN,KAAK,GAAGzB,QAAUhC,EAAM,MAE7BkR,MAEZ,IAIR,CAACrH,EAAYxB,IAGhB,MAAM8I,GAAkBhH,cAAatD,IACjC,IAAI8E,EAAQ,EAQZ,OAPAhH,OAAO6G,QAAQvC,GAAmBpE,QAAQ,EAAE7C,EAAK8C,OACzC9C,IAAQ6E,GAAe7E,EAAIgK,WAAW,GAAGnF,QACzClC,OAAOC,OAAOE,GAAcD,QAAQE,IAC5BA,GAAW4G,QAIpBA,GACR,CAAC1C,IAGEmI,GAAuBjH,EAAAA,YAAY,KACrC,IAAIkH,EAAa,EAMjB,OALA1M,OAAOC,OAAOqE,GAAmBpE,QAAQC,IACrCH,OAAOC,OAAOE,GAAcD,QAAQE,IAC5BA,GAAWsM,QAGhBA,GACR,CAACpI,IAEEqI,GAAuBnH,EAAAA,YAAY,WACrCF,EAA0BsH,SAAU,EACpCrI,EAAqB,CAAA,GACrBb,EAA0B,IAC1B,MAAAM,GAAAA,EAAqB,MACrB,MAAAC,GAAAA,EAAmB,MACnBE,EAAmB,IAAIkC,KACvBhC,EAAyB,IAAIgC,KAG7BlB,EAAc,CAAA,GACdR,EAAkB,CAAA,GAClBE,EAA0B,CAAA,GAC1BE,EAAmB,CAAA,GACnBE,EAAoB,CAAA,GACpB,OAAAxH,EAAA2H,EAAawH,UAAbnP,EAAsB1C,SACvB,CAACwJ,EAAsBb,EAA2BM,EAAoBC,EAAkBE,EAAoBE,IAG/G7J,EAAAA,UAAU,KACN,MAAAiK,GAAAA,EAAmBkI,KACpB,CAACA,GAAsBlI,IAE1B,MAAMoI,GAAqBrH,EAAAA,YAAY,KACnC9F,KACD,CAACA,IAMEoN,GAAwBrG,EAAAA,QAAQ,KAElC,MAAMsG,IAAuBvL,EACvBwL,IAAqBtL,EACrBuL,EAAuBF,GAAsBC,EAC7CE,EAAmBH,GAAsBC,EAGzCG,EAAmBjJ,EAAgBkJ,KAAO,GAAKhJ,EAAsBgJ,KAAO,GAAKF,EACjFG,EAAanJ,EAAgBkJ,KAAO,GAAKhJ,EAAsBgJ,KAAO,GAAKH,EAIjF,MAAO,CAAEK,QAFOH,EAECI,aAHIJ,IAAqBE,EAGXA,eAChC,CAACnJ,EAAiBE,EAAuB5C,EAAiBE,IAI7DlH,EAAAA,UAAU,KACN,MAAAuJ,GAAAA,EAAoB+I,GAAsBO,aAC3C,CAACP,GAAsBO,WAAYtJ,IAGtCvJ,EAAAA,UAAU,KACN,GAAIsJ,EAAmB,CACnB,MAAM0J,EAA+B,YAAf5H,GAA4BkH,GAAsBS,aACxEzJ,EAAkB0J,EACtB,GACD,CAACV,GAAsBS,aAAczJ,EAAmB8B,IAG3D,MAIM6H,GAA0BjI,EAAAA,YAAY,WACxC,GAAIU,GAAekC,OAAQ,CAEvB,MAAMqC,EAActO,OAAOC,SAASsR,SACpC,IAAIC,EAAa,cACblD,EAAY/M,SAAS,kBACrBiQ,EAAa,iBACNlD,EAAY/M,SAAS,oBAC5BiQ,EAAa,mBACNlD,EAAY/M,SAAS,iBAC5BiQ,EAAa,eAGjB,MAAMpM,EAA+B,CACjCC,kBACAE,gBACAC,QAAS,IAAI0E,IAAInC,GACjBpC,cAAe,IAAIuE,IAAIjC,IAI3B,IAAIwJ,EACJ,GAAIpK,IAAiB,OAAA/F,EAAA+F,EAAc,SAAd,EAAA/F,EAAkBoQ,OAAQrK,EAAc,GAAGqK,KAAKpT,OAAS,EAAG,CAE7EmT,EADiBpK,EAAc,GAAGqK,KAAK,GACXC,OAChC,CAEA,MAAMxP,EAAM7C,KAAK6C,MACXC,EAAyB,CAC3BC,GAAIF,EAAIG,WACRuC,KAAMkF,GAAekC,OACrBxH,WAAY+C,EACZ5D,aAAcuE,EACdhE,eAAgB,IAAIrG,GACpBsH,gBACA7C,YAAaJ,EACbK,iBAAkBL,EAClBM,aAAcN,EACdO,UAAU,EACV8O,aACAC,oBAGE1O,EAAkB,IAAI4G,GAAevH,GAC3CwH,GAAiB7G,GACjBmC,EAAkBnC,GAGlB6O,EAAWC,SAAS,4BAA6B,CAAEC,QAAS,MAE5D9H,GAAkB,IAClBF,IAAiB,EACrB,GACD,CAACC,GAAgBhC,EAAiBE,EAAuB5C,EAAiBE,EAAeiC,EAAOW,EAAmBrK,EAAwB6L,GAAetC,IAEvJ0K,GAAyB,KAC3B/H,GAAkB,IAClBF,IAAiB,IA6FfkI,GAAoB,KACtBC,GAAmB,OAIjBC,GAAkBC,IACpB,IAAKA,EAAW,MAAO,aACvB,MAAM/S,EAAO,IAAIE,KAAK6S,GAEhBC,OADU9S,MACGiO,UAAYnO,EAAKmO,UAC9B8E,EAAWC,KAAKC,MAAMH,SAE5B,OAAiB,IAAbC,EACO,QACa,IAAbA,EACA,YACAA,EAAW,EACX,GAAGA,aAEHjT,EAAKoT,uBA0CbC,GAAmBC,IAAwBxU,EAAAA,UAAS,IACpDyU,GAAcC,IAAmB1U,EAAAA,SAAS,KAC1C2U,GAAmBC,IAAwB5U,EAAAA,SAAS,KACpD6U,GAAiBC,IAAsB9U,EAAAA,SAAwB,OAG/D+U,GAAiBC,IAAsBhV,EAAAA,UAAS,IAChDiV,GAAgBC,IAAqBlV,EAAAA,SAAwB,OAC7DmV,GAAkBC,IAAuBpV,EAAAA,SAAS,KAGlDqV,GAAiBtB,IAAsB/T,EAAAA,SAAwB,OAC/DsV,GAAiBC,IAAsBvV,EAAAA,SAAS,CAAEwV,EAAG,EAAGC,EAAG,IAiB5DC,GAAwBvK,EAAAA,YAAY,WACtC,IAAK0J,GAED,YADAL,IAAqB,GAIzB,MAAMtN,EAA+B,CACjCC,kBACAE,gBACAC,QAAS,IAAI0E,IAAInC,GACjBpC,cAAe,IAAIuE,IAAIjC,IAI3B,IAAIwJ,EACJ,GAAIpK,IAAiB,OAAA/F,EAAA+F,EAAc,SAAd,EAAA/F,EAAkBoQ,OAAQrK,EAAc,GAAGqK,KAAKpT,OAAS,EAAG,CAC7E,MAAMuV,EAAWxM,EAAc,GAAGqK,KAAK,GACvCD,EAAmBoC,EAASlC,OAChC,CAEA,MAAMxP,EAAM7C,KAAK6C,MACX2R,EAAUnK,GAAc3G,IAAIC,GAC9BA,EAAEZ,KAAO0Q,GACH,IACK9P,EACH4B,KAAMgO,GAAkB5G,QAAUhJ,EAAE4B,KACpCJ,WAAY+C,EACZ5D,aAAcuE,EACdhE,eAAgB,IAAIrG,GACpBsH,gBACA5C,iBAAkBL,EAClBsP,oBAEFxO,GAGV2G,GAAiBkK,GACjB5O,EAAkB4O,GAGlBlC,EAAWC,SAAS,oCAAqC,CAAEC,QAAS,MAEpEY,IAAqB,GACrBE,GAAgB,IAChBE,GAAqB,IACrBE,GAAmB,OACpB,CAACD,GAAiBhL,EAAiBE,EAAuB5C,EAAiBE,EAAeiC,EAAOW,EAAmBrK,EAAwB6L,GAAekJ,GAAmBxL,IAEjL,OACIrI,EAAAA,KAAAyH,WAAA,CACI1H,SAAA,CAAAF,EAAAA,IAAC,OAAIC,UAAU,yBACXC,SAAAC,EAAAA,KAAC,MAAA,CAAIF,UAAU,eACXC,SAAA,CAAAF,EAAAA,IAAC,OAAIC,UAAU,sBACXC,SAAAC,EAAAA,KAAC,MAAA,CAAIF,UAAU,oBACXC,SAAA,CAAAC,EAAAA,KAAC,MAAA,CACGF,UAAW,gCAA8C,YAAf2K,EAA2B,SAAW,IAChF3C,QAAS,IAAM4C,GAAc,WAC7BsF,MAAO,CAAEO,OAAQ,WAEjBxQ,SAAA,CAAAC,EAAAA,KAAC,SAAA,CACGF,UAAW,qBAAmC,YAAf2K,EAA2B,SAAW,IACrE3C,QAAS,IAAM4C,GAAc,WAC7BzE,KAAK,SACRlG,SAAA,CAAA,UAEIuR,KAAyB,GACtBzR,EAAAA,IAAC,OAAIC,UAAU,qDAAsDC,mBAG7EF,EAAAA,IAAC,SAAA,CACGC,UAAW,yBACXgI,QAAUC,IACN2C,GAAc,WACd3C,EAAEC,kBACFwJ,MAEJvL,KAAK,SACRlG,SAAA,iBAILF,EAAAA,IAAC,MAAA,CACGC,UAAW,iCAA+C,UAAf2K,EAAyB,SAAW,IAC/E3C,QAAS,IAAM4C,GAAc,SAC7BsF,MAAO,CAAEO,OAAQ,WAEjBxQ,SAAAF,EAAAA,IAAC,SAAA,CACGC,UAAW,qBAAmC,UAAf2K,EAAyB,SAAW,IACnE3C,QAAS,IAAM4C,GAAc,SAC7BzE,KAAK,SACRlG,SAAA,6BAMG,YAAf0K,EACG5K,EAAAA,IAAC,MAAA,CAAIC,UAAU,oBAETC,SAMS,IALY8E,OAAO6G,QAAQpD,GAGDlE,OAAO,EAAElC,MAAU2C,OAAOmH,KAAKhG,GAAczD,SAASL,OAIhF2C,OAAO6G,QAAQ1F,IAErBhC,IAAI,EAAE+C,EAAaC,MACpB,MAAMrG,EAAQqG,EAAMrG,OAASoG,EACvBI,EAAekK,GAAgBtK,GAErC,OACIlH,EAAAA,IAAC+G,EAAA,CAEGG,cACAC,QACArG,QACAsG,aAAcsC,EAAexC,GAC7BG,eAAgByC,EAAgB5C,GAChCtB,WAAYoE,EAAiB9C,IAAgB,GAC7CI,eACAC,SAAUiG,GACVhG,eAAgB6G,GAChB5G,eAAgB8G,GAChB7G,eAAgB8G,GAChB7G,cAAekJ,IAZV3J,SAkBrBlH,IAAC,MAAA,CAAIC,UAAU,sBACVC,SAAyB,IAAzB4K,GAAcrL,OACXU,OAAC,MAAA,CAAIF,UAAU,uBACXC,SAAA,GAAAF,IAAC,KAAEE,SAAA,6BACHF,IAAC,KAAEE,SAAA,gFAGP,IAAI4K,IACCtF,KAAK,CAACC,EAAGC,KACN,MAAMwP,EAAOzP,EAAE5B,SAAW,EAAI,EACxBsR,EAAOzP,EAAE7B,SAAW,EAAI,EAC9B,GAAIsR,IAASD,EAAM,OAAOC,EAAOD,EACjC,MAAME,EAAQ3P,EAAE7B,cAAgB,EAEhC,OADc8B,EAAE9B,cAAgB,GACjBwR,IAElBjR,IAAKU,GACF7E,EAAAA,IAAC,MAAA,CAEGC,UAAU,oBACVoV,aAAenN,GA5P7B,EAAClE,EAAkBsK,KACzC8E,GAAmBpP,GACnB,MAAMsR,EAAOhH,EAAMiH,cAAcC,wBACjCZ,GAAmB,CACfC,EAAGS,EAAKG,KAAOH,EAAK/E,MAAQ,EAC5BuE,EAAGQ,EAAKI,IAAM,MAuPuCC,CAAkB9Q,EAAYrB,GAAI0E,GACvD0N,aAAczC,GAEdjT,SAAAC,EAAAA,KAAC,MAAA,CAAIF,UAAU,oBACXC,SAAA,GAAAC,KAAC,MAAA,CAAIF,UAAU,qBACXC,SAAA,CAAAF,EAAAA,IAAC,SAAA,CACGC,UAAU,yBACVmG,KAAK,SACL6B,QAAUC,IArVhC,CAACrD,IAE3B,GAAIA,EAAY8N,aACQxR,OAAOC,SAASsR,SAGnBhQ,SAASmC,EAAY8N,YAAa,CAC/C,MAAMkD,EAAYC,EAAoBjR,GAEtC,YADA1D,OAAOC,SAAS2U,KAAOF,EAE3B,CAIJ1C,KAGAxB,KAGA,MAAM/L,EAAaf,EAAYe,YAAc,GAC7CgD,EAAShD,GAITyL,WAAW,KAEP/G,EAA0BsH,SAAU,EAEpCrI,EAAqB1E,EAAYE,cACjC2D,EAA0B7D,EAAYS,gBAGlCT,EAAY0B,gBACZ,MAAAyC,GAAAA,EAAqBnE,EAAY0B,cAAcC,iBAC/C,MAAAyC,GAAAA,EAAmBpE,EAAY0B,cAAcG,eAC7CyC,EAAmB,IAAIkC,IAAIxG,EAAY0B,cAAcI,UACrD0C,EAAyB,IAAIgC,IAAIxG,EAAY0B,cAAcO,iBAI/D+D,GAAc,WAGd,MAAMvH,EAAM7C,KAAK6C,MACX0S,EAAclL,GAAc3G,IAAIC,GAAKA,EAAEZ,KAAOqB,EAAYrB,GAAK,IAAKY,EAAGR,aAAcN,GAAQc,GACnG2G,GAAiBiL,GACjB3P,EAAkB2P,IACnB,IAsSiDC,CAAsBpR,GACrBqD,EAAEqN,cAAoCW,QAE3CC,MAAM,yBAELjW,SAAA2E,EAAYmB,OAEjBhG,EAAAA,IAAC,SAAA,CACGC,UAAW,yBAAwB4E,EAAYhB,SAAW,WAAa,IACvEsS,MAAM,WACNlO,QAAUC,IACN,MAAM+M,EAAUnK,GAAc3G,IAAIC,GAAKA,EAAEZ,KAAOqB,EAAYrB,GAAK,IAAKY,EAAGP,UAAWO,EAAEP,UAAaO,GACnG2G,GAAiBkK,GACjB5O,EAAkB4O,GACjB/M,EAAEqN,cAAoCW,QAE3C9P,KAAK,SAELlG,eAAC,MAAA,CAAI2H,IAAKhD,EAAYhB,SAAW,8CAAqD,4CAAkDiE,IAAI,oBAGpJ3H,KAAC,MAAA,CAAIF,UAAU,4BACXC,SAAA,CAAAF,EAAAA,IAAC,SAAA,CACGC,UAAU,wBACVkW,MAAM,OACNlO,QAAUC,IAjPhC3G,OAAOsD,IACjC,IACI,MAAMuR,EAAON,EAAoBjR,SAC3BwR,UAAUC,UAAUC,UAAUH,GACpC,MAAM9S,EAAM7C,KAAK6C,MACX2R,EAAUnK,GAAc3G,IAAIC,GAAKA,EAAEZ,KAAOqB,EAAYrB,GAAK,IAAKY,EAAGR,aAAcN,GAAQc,GAC/F2G,GAAiBkK,GACjB5O,EAAkB4O,GAGlBlC,EAAWC,SAAS,mCAAoC,CAAEC,QAAS,KACvE,OAAS/K,GACLjG,QAAQuU,KAAK,+DAEbrV,OAAOsV,OAAO,iBAAkBX,EAAoBjR,IACpD,MAAMvB,EAAM7C,KAAK6C,MACX2R,EAAUnK,GAAc3G,IAAIC,GAAKA,EAAEZ,KAAOqB,EAAYrB,GAAK,IAAKY,EAAGR,aAAcN,GAAQc,GAC/F2G,GAAiBkK,GACjB5O,EAAkB4O,GAGlBlC,EAAWC,SAAS,mCAAoC,CAAEC,QAAS,KACvE,GA4NoDyD,CAAsB7R,GACrBqD,EAAEqN,cAAoCW,QAE3C9P,KAAK,SAELlG,SAAAF,EAAAA,IAAC,OAAI6H,IAAK,8CAAoDC,IAAI,WAEtE9H,EAAAA,IAAC,SAAA,CACGC,UAAU,wBACVkW,MAAM,OACNlO,QAAUC,IArNnC,CAACrD,IACxB,MAAMuR,EAAON,EAAoBjR,GACjCkP,GAAgBqC,GAChBnC,GAAqBpP,EAAYmB,MACjCmO,GAAmBtP,EAAYrB,IAC/BqQ,IAAqB,IAiN+B8C,CAAmB9R,GAClBqD,EAAEqN,cAAoCW,QAE3C9P,KAAK,SAELlG,SAAAF,EAAAA,IAAC,OAAI6H,IAAK,8CAAoDC,IAAI,WAEtE9H,EAAAA,IAAC,SAAA,CACGC,UAAU,0BACVgI,QAAUC,IAjV9B,CAAClE,IAC7B,MAAM4S,EAAiB9L,GAAczG,KAAKD,GAAKA,EAAEZ,KAAOQ,GAClD6S,SAAaD,WAAgB5Q,OAAQ,oBAE3CuO,GAAkBvQ,GAClByQ,GAAoBoC,GACpBxC,IAAmB,IA4UiCyC,CAAwBjS,EAAYrB,IACnC0E,EAAEqN,cAAoCW,QAE3C9P,KAAK,SACL+P,MAAM,SAENjW,SAAAF,EAAAA,IAAC,OAAI6H,IAAK,gDAAsDC,IAAI,oBAhE3EjD,EAAYrB,YA8E7CoQ,UACK,MAAA,CAAI3T,UAAU,oBACXC,SAAAC,EAAAA,KAAC,MAAA,CAAIF,UAAU,4BACXC,SAAA,CAAAF,EAAAA,IAAC,OAAIC,UAAU,2BACXC,SAAAF,MAAC,KAAA,CAAGE,mCAERC,KAAC,MAAA,CAAIF,UAAU,yBACXC,SAAA,GAAAC,KAAC,MAAA,CAAIF,UAAU,oBACXC,SAAA,CAAAF,MAAC,QAAA,CAAM+W,QAAQ,mBAAmB9W,UAAU,0BAA0BC,SAAA,iBACtEF,EAAAA,IAAC,QAAA,CACGwD,GAAG,mBACH4C,KAAK,OACL/F,MAAO2T,GACP1T,SAAW4H,GAAM+L,GAAqB/L,EAAEE,OAAO/H,OAC/CJ,UAAU,oBACV8H,YAAY,oBACZC,WAAS,SAGjB7H,KAAC,MAAA,CAAIF,UAAU,oBACXC,SAAA,OAAC,QAAA,CAAMD,UAAU,0BAA0BC,SAAA,oBAC3CF,EAAAA,IAAC,WAAA,CACGC,UAAU,6CACVI,MAAOyT,GACPkD,UAAQ,EACRC,KAAM,YAIlB9W,KAAC,MAAA,CAAIF,UAAU,2BACXC,SAAA,CAAAF,EAAAA,IAAC,UAAOC,UAAU,yBAAyBgI,QA1Q3C,KACxB4L,IAAqB,GACrBE,GAAgB,IAChBE,GAAqB,IACrBE,GAAmB,OAsQ8E/N,KAAK,SAASlG,SAAA,WACvFF,EAAAA,IAAC,SAAA,CACGC,UAAU,0BACVgI,QAAS8M,GACT3O,KAAK,SACL8Q,UAAWlD,GAAkB5G,OAChClN,SAAA,mBAajBkU,UACK,MAAA,CAAInU,UAAU,oBACXC,SAAAC,EAAAA,KAAC,MAAA,CAAIF,UAAU,4BACXC,SAAA,CAAAF,EAAAA,IAAC,OAAIC,UAAU,2BACXC,SAAAF,MAAC,KAAA,CAAGE,mCAERF,MAAC,MAAA,CAAIC,UAAU,yBACXC,gBAAC,IAAA,CAAEA,SAAA,CAAA,sCAAiCF,IAAC,UAAQE,SAAAsU,KAA0B,YAE3ErU,KAAC,MAAA,CAAIF,UAAU,2BACXC,SAAA,CAAAF,EAAAA,IAAC,SAAA,CACGC,UAAU,yBACVgI,QA5YL,KACvBoM,IAAmB,GACnBE,GAAkB,MAClBE,GAAoB,KA0YQrO,KAAK,SACRlG,SAAA,WAGDF,EAAAA,IAAC,SAAA,CACGC,UAAU,4BACVgI,QAjaJ,KACxB,GAAIqM,GAAgB,CAChB,MAAMpQ,EAAkB4G,GAAcvG,OAAOH,GAAKA,EAAEZ,KAAO8Q,IAC3DvJ,GAAiB7G,GACjBmC,EAAkBnC,GAGlB6O,EAAWC,SAAS,oCAAqC,CAAEC,QAAS,KACxE,CACAoB,IAAmB,GACnBE,GAAkB,MAClBE,GAAoB,KAuZQrO,KAAK,SACRlG,SAAA,mBAWjBwU,IACI1U,EAAAA,IAAC,MAAA,CACGC,UAAU,uBACVkQ,MAAO,CACHgH,SAAU,QACV1B,KAAM,GAAGd,GAAgBE,MACzBa,IAAK,GAAGf,GAAgBG,MACxBsC,UAAW,yBACXC,cAAe,OACfC,OAAQ,MAGVpX,eACE,MAAMwE,EAASoG,GAAczG,KAAKD,GAAKA,EAAEZ,KAAOkR,IAChD,OAAKhQ,IAEDvE,KAAC,MAAA,CAAIF,UAAU,kBACXC,SAAA,CAAAF,MAAC,OAAIC,UAAU,uBACVC,SAAAwE,EAAOkB,YAAc,0BAEzB,MAAA,CAAI3F,UAAU,uBACTC,eACE,MAAMqX,EA9YzB,CAAC1S,IAClB,IAAI2S,EAAmB,EACvBxS,OAAOC,OAAOJ,EAAYE,cAAcG,QAAQC,IAC5CH,OAAOC,OAAOE,GAAcD,QAAQE,IAC5BA,GAAWoS,QAGvB,MAAMC,EAAqB5S,EAAYS,eAAe7F,OACtD,OAAO+X,EAAmBC,GAsY8B7S,CAAaF,GACjC,OAAoB,IAAhB6S,EAA0B,aACV,IAAhBA,EAA0B,WACvB,GAAGA,WACd,SAEJpX,KAAC,MAAA,CAAIF,UAAU,oBAAoBC,SAAA,CAAA,cACnBmT,GAAe3O,EAAOd,oBAf1B,IAmBxB,OAOO,YAAfgH,GAA4BI,IACxBhL,EAAAA,IAAC,MAAA,CAAIC,UAAU,0BACXC,WAAAC,KAAC,MAAA,CAAIF,UAAU,qCACXC,SAAA,CAAAF,EAAAA,IAAC,QAAA,CACGoG,KAAK,OACL2B,YAAY,6BACZ1H,MAAO6K,GACP5K,SAAW4H,GAAMiD,GAAkBjD,EAAEE,OAAO/H,OAC5CJ,UAAU,2BACV+H,WAAS,EACTK,UAAYH,IACM,UAAVA,EAAE7F,IACFoQ,KACiB,WAAVvK,EAAE7F,KACT6Q,QAIZlT,EAAAA,IAAC,SAAA,CACGC,UAAU,8BACVmG,KAAK,SACL6B,QAASwK,GACTyE,UAAWhM,GAAekC,OAC7BlN,SAAA,cAUE,YAAf0K,GACIzK,EAAAA,KAAAyH,EAAAA,SAAA,CACM1H,SAAA,EAAA2I,GAAkBiJ,GAAsBS,eACtCvS,MAAC,MAAA,CAAIC,UAAU,4BAA6BC,SAAA,8DAIhDC,KAAC,MAAA,CAAIF,UAAU,uBACXC,SAAA,CAAAC,EAAAA,KAAC,SAAA,CACGF,UAAU,yBACVmG,KAAK,SACL8Q,SAAUrO,GAAkBiJ,GAAsBS,aAClDtK,QAAS+C,GAAgBkI,GAAyBrB,GAElD3R,SAAA,GAAAF,IAAC,OAAA,CAAKC,UAAU,0BACZC,SAAAF,EAAAA,IAAC,MAAA,CAAIuQ,MAAM,KAAKmH,OAAO,KAAKC,QAAQ,YAAYC,KAAK,OAAOC,OAAO,OAAOC,YAAY,IAAIC,cAAc,QAAQC,eAAe,QAC3H9X,SAAAF,EAAAA,IAAC,UAAA,CAAQiY,OAAO,mDAGvB,OAAA,CAAKhY,UAAU,0BAA0BC,SAAA,aAE9CC,EAAAA,KAAC,SAAA,CACGF,UAAW,0BAAyB+K,GAAgB,cAAgB,IACpE5E,KAAK,SACL6B,QAAS+C,GAAgBkI,GA3oB5B,KACrBjI,IAAiB,IA4oBO/K,SAAA,OAAC,OAAA,CAAKD,UAAU,yBACZC,SAAAF,EAAAA,IAAC,MAAA,CAAI6H,IAAK,4CAAkDC,IAAI,iBAEnE,OAAA,CAAK7H,UAAU,yBAA0BC,SAAA8K,GAAgB,SAAW"}